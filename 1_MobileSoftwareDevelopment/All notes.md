# <mark style="background: #AD21D9;">01 Android Overview</mark>

### <mark style="background: #AD21D9;">What is android?</mark>

Android is an open-source operating system based on Linux and Java for smartphones, tablets, car media and watches.  

Android was developed by the Open Handset Alliance which is led by Google.  
- Why do you think google did that? A free OS for phones?  

The first Android Software Development Kit (SDK) was  released in 2007. Google released Jelly Bean in 2012 with the idea of improving the user interface.  
- Why google created the SDK for free?  

Android is designed as a unique platform in the sense that developers only need to code their application in Android and it will run on any device.

### <mark style="background: #AD21D9;">Features of Android?</mark>
- Attractive UI  
- Connectivity: Wi-Fi, Bluetooth, NFC...  
- Storage: SQLite  
- Multi-Media: mp3, midi, png,...  
- Messaging: SMS  
- Web browser  
- Multi-touch  
- Multi-tasking  
- Google Cloud Messaging (GCM)  
- Multi-language  
- Android Beam: touching two NFC-enabled phones together.

### <mark style="background: #AD21D9;">The android ecosystem:</mark>

![](https://i.imgur.com/Gv4bSE0.png)

The <mark style="background: #AD21D9;">Linux</mark> operating system has been modified to make it <mark style="background: #AD21D9;">more interactive</mark> with the user (Touching screens, visual gestures)  

Android is not only designed for <mark style="background: #AD21D9;">phones</mark>, also for <mark style="background: #AD21D9;">cars</mark>, TVs and watches.  

<mark style="background: #AD21D9;">Vendors</mark> can <mark style="background: #AD21D9;">adapt</mark> android to their own brands (Samsung, Xiaomi, Oppo, ...)

### <mark style="background: #AD21D9;">Global Smartphone Market Share (Q3 2022 - Q2 2024)</mark>

![](https://i.imgur.com/jdIe9IF.png)

### <mark style="background: #AD21D9;">Elements of Android:</mark>

![](https://i.imgur.com/jws9fCj.png)

<mark style="background: #AD21D9;">Virtual Keyboard</mark> for characters, numbers and emojis  

Support for <mark style="background: #AD21D9;">Bluetooth</mark>, <mark style="background: #AD21D9;">USB</mark> controllers and Peripherals  

<mark style="background: #AD21D9;">Sensors</mark> can discover <mark style="background: #AD21D9;">User actions</mark> and respond

Device contents <mark style="background: #AD21D9;">rotate</mark> as needed

![](https://i.imgur.com/PDdODiH.png)

Self-updating <mark style="background: #AD21D9;">widgets</mark> for live contents

![](https://i.imgur.com/95h2yxH.png)

Folders to organise apps
![](https://i.imgur.com/BBK9hq0.png)

<mark style="background: #AD21D9;">Voice Assistance:</mark>
![](https://i.imgur.com/G79LCoX.png)

### <mark style="background: #AD21D9;">Android Version History:</mark>

<mark style="background: #AD21D9;">Pre-History (2009 – 2010):</mark>  
- Updated <mark style="background: #AD21D9;">user interface</mark> design with increased <mark style="background: #AD21D9;">simplicity and speed</mark>  
- Support for <mark style="background: #AD21D9;">NFC</mark>, allowing the user to read an Near Field Communication (NFC) tag embedded in a poster  
- Support for <mark style="background: #AD21D9;">third-party virtual keyboards</mark> with text prediction.  
- <mark style="background: #AD21D9;">Video recording</mark> and playback (MPEG-4 and 3GP formats)

<mark style="background: #AD21D9;">Middle Age (2011 - 2014):</mark>
- Support for <mark style="background: #AD21D9;">multi-core processors</mark>, ability to encrypt all user data  
- Multiple browser tabs replacing browser windows and a new <mark style="background: #AD21D9;">“incognito” mode</mark>  
- <mark style="background: #AD21D9;">Android Runtime</mark> (ART) with <mark style="background: #AD21D9;">ahead-of-time</mark> (AOT) compilation and improved GC  
- Support for 64-bit CPUs, <mark style="background: #AD21D9;">Material Design</mark>, bringing a restyled User Interface

<mark style="background: #AD21D9;">Modern Era (2015 – 2018):</mark>
- Android Runtime (ART) with ahead-of-time (AOT) compilation and improved GC  
- Support for 64-bit CPUs, Material Design, bringing a restyled User Interface  
- "Lockdown" mode which disables biometric authentication once activated  
- Rounded corners across the UI 

<mark style="background: #AD21D9;">Recent (2019-2022):</mark>
- Platform optimisations. have been made for foldable smartphones.  
- A feature known as "bubbles" that presents content in pop-up overlays.  

<mark style="background: #AD21D9;">Most Recent (2022-2024):</mark>  
- Enhanced Security  
- Media Picker  
- Extreme battery saver mode.

### <mark style="background: #AD21D9;">What is Google Play?</mark>

<mark style="background: #AD21D9;">Google play</mark> is the <mark style="background: #AD21D9;">official store</mark> for android applications  

Digital distribution service operated by Google

<mark style="background: #AD21D9;">Acusations of Monopoly:</mark> Epic Games has now filed lawsuits against both Apple and Google in a battle that’s likely to last months. Epic Games is uniquely positioned to pull off a stunt like this, and now poses a serious threat to how Apple, in particular, operates its App Store and iOS operating system. In summary, they charge too much for providing a simple service.

### <mark style="background: #AD21D9;">Number of applications available in the play store:</mark>

![](https://i.imgur.com/6qAXfo0.png)

### <mark style="background: #AD21D9;">What is an android app?</mark>

One or more interactive screens.  

Written using Kotlin/Java Programming Language and Jetpack Compose/XML  

Kotlin is a newer language for writing apps. It is translated into Java.  

Uses the Android Software Development Kit (SDK).  

Uses Android libraries and Android Application Framework.  

Executed by Android Runtime Virtual machine (ART).

![](https://i.imgur.com/bdyJsWR.png)

### <mark style="background: #AD21D9;">Challenges of Development</mark>

<mark style="background: #AD21D9;">Multiple screen sizes</mark> and resolutions.  

<mark style="background: #AD21D9;">Performance:</mark> make your apps <mark style="background: #AD21D9;">responsive</mark> and <mark style="background: #AD21D9;">smooth</mark>.  

<mark style="background: #AD21D9;">Security:</mark> keep source code and user data safe.  

<mark style="background: #AD21D9;">Compatibility:</mark> run well on older platform versions.  

Marketing: <mark style="background: #AD21D9;">understand the market</mark> and your users.(Hint: It doesn't have to be expensive, but it can be).

![](https://i.imgur.com/u7w9Od3.png)

<mark style="background: #AD21D9;">Resources:</mark> layouts, images, strings, colours as XML and media files.  

<mark style="background: #AD21D9;">Components:</mark> activities, services, and helper classes as Java code.  

<mark style="background: #AD21D9;">Manifest:</mark> information about app for the runtime.  

<mark style="background: #AD21D9;">Build configuration:</mark> APK versions in Gradle config files.

### <mark style="background: #AD21D9;">Android SDK:</mark>

<mark style="background: #AD21D9;">Development Tools</mark> (debugger, monitors, editors)  

<mark style="background: #AD21D9;">Libraries</mark> (maps, wearables)  

<mark style="background: #AD21D9;">Virtual Devices</mark> (emulators)  

<mark style="background: #AD21D9;">Documentation</mark> (developers.android.com)  

Sample Code

### <mark style="background: #AD21D9;">Android Studio:</mark>

Official <mark style="background: #AD21D9;">Android IDE</mark>  

Develop, run, <mark style="background: #AD21D9;">debug</mark>, <mark style="background: #AD21D9;">test</mark>, and package apps  

<mark style="background: #AD21D9;">Monitors</mark> and <mark style="background: #AD21D9;">performance</mark> tools  

<mark style="background: #AD21D9;">Virtual devices</mark>  

<mark style="background: #AD21D9;">Project views</mark>  

<mark style="background: #AD21D9;">Visual Layout Editor</mark>

![](https://i.imgur.com/st2FIRh.png)

![](https://i.imgur.com/6UvBSCd.png)

1. Contains the code files.  
2. Folder for <mark style="background: #AD21D9;">drawable objects</mark> under the file res.  
3. This is the file where you can define the <mark style="background: #AD21D9;">interface</mark> of your app.  
4. Folder where you can store the values of you define <mark style="background: #AD21D9;">colours and strings</mark>.  
5. It defines the <mark style="background: #AD21D9;">characteristics of the app</mark> (package name, activity names, main activity (the entry point to the app), Android version support, hardware features support, permissions...)  
6. <mark style="background: #AD21D9;">Gradle</mark> is a component of Android that is used to <mark style="background: #AD21D9;">compile</mark> the <mark style="background: #AD21D9;">different parts</mark> and dependencies of the project.

### <mark style="background: #AD21D9;">Activities:</mark>

![](https://i.imgur.com/Dw2luiR.png)

<mark style="background: #AD21D9;">Activities represent each screen of the app</mark>. For example, an email reading application can have an activity for messages, another for composing, and another for settings.

<mark style="background: #AD21D9;">Android Services:</mark>
An Android service is a <mark style="background: #AD21D9;">component</mark> that is designed to do some <mark style="background: #AD21D9;">work without</mark> a user <mark style="background: #AD21D9;">interface</mark>. A service might download a file, play music, or apply a filter to an image. Services can also be used for process communication (IPC) between Android applications.  

<mark style="background: #AD21D9;">Broadcast Receivers:</mark>
They <mark style="background: #AD21D9;">respond to broadcast messages</mark> from apps or from the system. When a file is downloaded, or when the Wi-Fi is active, low battery.  

<mark style="background: #AD21D9;">Content provider:</mark>
They supply <mark style="background: #AD21D9;">data to other applications</mark>. The <mark style="background: #AD21D9;">data</mark> can be <mark style="background: #AD21D9;">stored in a file</mark>, on a database, or on other systems (google cloud)

![](https://i.imgur.com/A9Z7zw0.png)

<mark style="background: #AD21D9;">onCreate()</mark>: The activity is <mark style="background: #AD21D9;">created</mark> internally.  

<mark style="background: #AD21D9;">onStart()</mark>: The activity is <mark style="background: #AD21D9;">visible</mark> to the user  

<mark style="background: #AD21D9;">onResume()</mark>: The user <mark style="background: #AD21D9;">interacts</mark> with the activity  

<mark style="background: #AD21D9;">onPause()</mark>: The user goes to another activity but still visible.  

<mark style="background: #AD21D9;">onStop()</mark>: Activity is not in the screen.  

<mark style="background: #AD21D9;">onDestroy()</mark>: The user/system kills the activity.  

<mark style="background: #AD21D9;">onRestart()</mark>: The activity is <mark style="background: #AD21D9;">restarted</mark> by the <mark style="background: #AD21D9;">user</mark>.

### <mark style="background: #AD21D9;">Android - UI Layouts</mark>

![](https://i.imgur.com/uGFAjBo.png)

<mark style="background: #AD21D9;">View</mark> is an object from the View class and <mark style="background: #AD21D9;">occupies a rectangular area</mark> on the screen. It performs drawing and event handling.  

View is the <mark style="background: #AD21D9;">base class for widget</mark> (buttons, text fields, etc.)  

A <mark style="background: #AD21D9;">ViewGroup</mark> is a subclass View that behaves like a <mark style="background: #AD21D9;">container</mark> for more Views or other ViewGroups.  

Layouts which are subclasses of ViewGroup class  

Layouts are declared using the <mark style="background: #AD21D9;">XML</mark> file main_layout.xml located in "res/layout"

### <mark style="background: #AD21D9;">Android UI Controls:</mark>

In the above figure:  
1. Button  
2. Text field  
3. Seek bar  
4. Checkboxes  
5. Radio buttons  
6. Toggle  
7. Spinner

![](https://i.imgur.com/tKDYrzo.png)

![](https://i.imgur.com/66RDYlY.png)

### <mark style="background: #AD21D9;">Event Handling:</mark>

Events are used for asynchrony interactions. It is used to interact the actions of the users such as clicking a button, scrolling up or down, or typing a text.  

There are three different kind of events:  
- <mark style="background: #AD21D9;">Event listeners:</mark> It only has one call-back action that is executed when the users triggers an event on that item.  
- <mark style="background: #AD21D9;">Event handler:</mark> It is called by the event listener to handle the event.  
- <mark style="background: #AD21D9;">Event Listeners Registration:</mark> It is the process by which the event handler is registered. <mark style="background: #AD21D9;">Links</mark> the <mark style="background: #AD21D9;">listener</mark> with the <mark style="background: #AD21D9;">handler</mark>.

### <mark style="background: #AD21D9;">Event handling Methods:</mark>

![](https://i.imgur.com/xfZ5IKm.png)

### <mark style="background: #AD21D9;">Callback Functions:</mark>

A callback function is a function which is:
- It is passed as a parameter 
- It is accessible by another function, and  
- It is invoked after the first function if that first function completes  
- The name tends to confuse. Maybe a better name would be “Call after function”. Maybe a better name would be a "call after" function.  
- They are used in asynchronous communications to manage events.

# <mark style="background: #AD21D9;">02 User Interface:</mark>

### <mark style="background: #AD21D9;">View System:</mark>

The Java API Framework comes with a <mark style="background: #AD21D9;">built-in</mark> View System

![](https://i.imgur.com/xi2GllC.png)

<mark style="background: #AD21D9;">Examples:</mark>
If you look at your mobile device, every <mark style="background: #AD21D9;">User Interface</mark> element that you see is a <mark style="background: #AD21D9;">View</mark>.

![](https://i.imgur.com/TUpgiRR.png)

![](https://i.imgur.com/VXUO3bi.png)

### <mark style="background: #AD21D9;">What is a View?</mark>

<mark style="background: #AD21D9;">View subclasses are basic User-Interface building blocks</mark>  
- Display text (``TextView`` class), Edit text (``EditText`` class)  
- Buttons (``Button`` class), ``menus``, other controls  
- Scrollable (``ScrollView``, ``RecyclerView``)  
- Show images (``ImageView``)  
- Group views (``ConstraintLayout`` and ``LinearLayout``)

<mark style="background: #AD21D9;">Button:</mark>
- <mark style="background: #AD21D9;">View</mark> that responds to <mark style="background: #AD21D9;">tapping</mark> (clicking) or pressing  
- Usually text or visuals indicate what will happen when tapped

![](https://i.imgur.com/QSUhO4v.png)

<mark style="background: #AD21D9;">EditText:</mark>
- ``EditText`` default lines of text  
- Alphanumeric Keyboard  
- Suggestions appear  
- Tapping <mark style="background: #AD21D9;">Return</mark> key starts new line  
- Set in Attributes pane of Layout Editor

![](https://i.imgur.com/CyfczOL.png)

<mark style="background: #AD21D9;">Messages:</mark>
- Single line of text  
- ``android:inputType =  “textShortMessage”``  
- Tapping Emoticons key changes keyboard to emoticons 
- Tapping ``Done`` key advances focus to next View

![](https://i.imgur.com/B48TPeh.png)

<mark style="background: #AD21D9;">Phone Numbers:</mark>
- For phone number entry  
- ``android:inputType = “phone”``  
- Numeric keypad (numbers only)  
- Tapping Done key advances focus to next View

![](https://i.imgur.com/iC4RJ0X.png)

<mark style="background: #AD21D9;">Dates:</mark>
- For date entry  
- ``android:inputType = “date”``  
- Numeric keypad (numbers only)  
- Tapping ``Done`` key advances focus to next View  
- Note prominence of <mark style="background: #AD21D9;">backslash</mark> /
![](https://i.imgur.com/Hlmxvo2.png)

### <mark style="background: #AD21D9;">Input types:</mark>

``textCapCharacters:`` Set to ALL CAPITAL LETTERS  

``textPassword:`` Conceal an entered p******d  

``number:`` <mark style="background: #AD21D9;">Restrict</mark> text entry to numbers  

``textEmailAddress:`` Show keyboard with @ conveniently located  

``datetime:`` Show a numeric keypad with a slash and colon for entering the date and time.

<mark style="background: #AD21D9;">CheckBox:</mark>
- User can select <mark style="background: #AD21D9;">any</mark> number of choices  
- Checking one box does <mark style="background: #AD21D9;">not</mark> uncheck another  
- Users expect checkboxes in a <mark style="background: #AD21D9;">vertical</mark> list  
- Commonly used with a <mark style="background: #AD21D9;">Submit</mark> button

![](https://i.imgur.com/M3zvWej.png)

<mark style="background: #AD21D9;">RadioButton:</mark>
- Put ``RadioButton`` elements in a ``RadioGroup`` in a vertical list (horizontally if labels are short)  
- User can select <mark style="background: #AD21D9;">only one</mark> of the choices  
- Checking one <mark style="background: #AD21D9;">unchecks</mark> all others  
- Commonly used with a Submit button for the ``RadioGroup``

<mark style="background: #AD21D9;">Toggle Buttons / Switches:</mark>
- User can switch between On and Off

![](https://i.imgur.com/R068m5Q.png)

### <mark style="background: #AD21D9;">Custom Views:</mark>

Over 100 different types of Views available from the Android system, all <mark style="background: #AD21D9;">children</mark> of the ``View`` class  

If necessary, ``create custom views`` by <mark style="background: #AD21D9;">subclassing</mark> existing views or the ``View`` class itself

<mark style="background: #AD21D9;">View Attributes:</mark>
- Every ``View`` and ``ViewGroup`` object supports their own set of attributes.  
- Some attributes are specific to a ``View`` object e.g. ``TextView`` supports the ``textSize`` attribute.  
- Some are common to all ``View`` objects, because they are inherited from the root View class e.g. the ``id`` attribute.

<mark style="background: #AD21D9;">Create Views and Layouts:</mark>
1. Android Studio Layout Editor: visual representation of XML  
2. XML Editor  
3. Kotlin/Java code

![](https://i.imgur.com/V92JEiB.png)

<mark style="background: #AD21D9;">ViewGroup and View hierarchy:</mark>

![](https://i.imgur.com/v3FjmKp.png)

<mark style="background: #AD21D9;">Scroll View:</mark>
- Allows ``View`` placed within it be scrolled.  
- Only 1 direct child placed within it.  
- To add multiple views make the direct child a view group e.g. ``LinearLayout``.  
- Supports <mark style="background: #AD21D9;">vertical</mark> scrolling only.

![](https://i.imgur.com/XX8AfBV.png)

<mark style="background: #AD21D9;">Recycler View:</mark>
- If your app needs to display a scrolling list of elements based on large data sets (or data that frequently changes).  
- Replacement for older ListView.

![](https://i.imgur.com/p5pJVkc.png)

- Cards provide an easy way to contain a group of views while providing a consistent style for the container.  
- Lists of these cards can then be displayed in a Recycler View.

![](https://i.imgur.com/TInnBh3.png)

### <mark style="background: #AD21D9;">ViewGroups for Layouts:</mark>

<mark style="background: #AD21D9;">Layouts:</mark>  
- Are specific types of ViewGroups (subclasses of ViewGroup)  
- Contain child views  
- Can be in a row, column, grid, table, absolute

### <mark style="background: #AD21D9;">Common Layout Classes:</mark>

![](https://i.imgur.com/98yK5Ta.png)

<mark style="background: #AD21D9;">Linear Layout:</mark>
- Aligns all children in a <mark style="background: #AD21D9;">single</mark> direction, vertically or horizontally.  
- Specify layout direction with <mark style="background: #AD21D9;">orientation</mark> attribute.  
- Vertical list will only have 1 child per row.  
- Respects margins between children and <mark style="background: #AD21D9;">gravity</mark> (alignment) of each child.

![](https://i.imgur.com/GnKAsKf.png)

<mark style="background: #AD21D9;">Relative Layout:</mark>

Displays child view in a relative position  

The position of each view can be relative to the sibling, (like on the left or below another view)  

Or relative to the position of the main area of the relative layout, like bottom, left, or centre.

![](https://i.imgur.com/DrRVufz.png)

<mark style="background: #AD21D9;">Constraint Layout:</mark>
- Create large and complex layouts with a flat view hierarchy (no nested view groups).  
- Laid out according to relationships between sibling views and the parent layout.  
- Layout Editor specially built for it.  
- Drag and drop v's XML editing

![](https://i.imgur.com/QXjZwMd.png)

![](https://i.imgur.com/Ypb9BLD.png)

[Constraint video](https://www.youtube.com/watch?v=XamMbnzI5vE)

<mark style="background: #AD21D9;">Grid Layout:</mark>
- A layout that places its children in a rectangular grid.  
- The grid separates the viewing area into cells.  
- Children occupy one or more contiguous cells

![](https://i.imgur.com/5GczcU9.png)

<mark style="background: #AD21D9;">Table Layout:</mark>
- Arranges children into rows and columns.  
- Consists of ``TableRow`` objects, each defining a <mark style="background: #AD21D9;">row</mark> of 0 or more cells.  
- A cell can hold one View object.  
- Has as many <mark style="background: #AD21D9;">columns</mark> as row with most cells.

![](https://i.imgur.com/AjerqEu.png)

### <mark style="background: #AD21D9;">Class and Layout Hierarchies:</mark>

View class-hierarchy is standard <mark style="background: #AD21D9;">object-oriented</mark> class Inheritance  
- For example, ``Button`` is-a ``TextView`` is-a ``View`` is-an ``Object``  
- Superclass-subclass relationship  

Layout hierarchy is how Views are visually arranged  
- ``LinearLayout`` can <mark style="background: #AD21D9;">contain</mark> Buttons arranged in a row  
- Parent-child relationship

<mark style="background: #AD21D9;">Hierarchy of Viewgroups/Views:</mark>
- Root View is always a <mark style="background: #AD21D9;">ViewGroup</mark>

![](https://i.imgur.com/x1dlF9G.png)

<mark style="background: #AD21D9;">View hierarchy and screen layout:</mark>

![](https://i.imgur.com/79aedpq.png)

### <mark style="background: #AD21D9;">In the Layout editor:</mark>

![](https://i.imgur.com/XOttGVA.png)

![](https://i.imgur.com/cA9yCDi.png)

### <mark style="background: #AD21D9;">Layout created in XML</mark>

```XML
<LinearLayout  
	android:orientation="vertical"  
	android:layout_width="match_parent"  
	android:layout_height="match_parent">  
	
	<Button  
	... />  
	<TextView  
	... />  
	<Button  
	... />  
</LinearLayout>
```

### <mark style="background: #AD21D9;">Note:</mark>

Context is an interface to global information about an application environment  

Get the context:  
``Context context = getApplicationContext();``  

An Activity is its own context:  
``TextView myText = new TextView(this);``

<mark style="background: #AD21D9;">Best Practices:</mark>
- Arrangement of View hierarchy affects app performance  
- Use smallest number of simplest views possible  
- Keep the hierarchy flat i.e. limit nesting of views and view groups

### <mark style="background: #AD21D9;">Resources:</mark>
- Separate static data from code in your layouts.  
- Strings, dimensions, images, menu text, colours, styles  
- Useful for localisation

The API Framework allows us easily use app Resources.

![](https://i.imgur.com/cagJMFL.png)

![](https://i.imgur.com/ehEHj5o.png)

### <mark style="background: #AD21D9;">Drawables:</mark> 

Drawable—generic Android class used to represent any kind of graphic.  

Bitmaps e.g. PNG (.png), JPG (.jpg), or GIF (.gif) format.  

Vector Graphics, scale smoothly for all screen sizes e.g. defined in XML.

![](https://i.imgur.com/B3ZiCZj.png)

### <mark style="background: #AD21D9;">What is a Style?</mark>

Collection of <mark style="background: #AD21D9;">attributes</mark> that define the <mark style="background: #AD21D9;">visual appearance of a View</mark>  

Reduce <mark style="background: #AD21D9;">duplication</mark>  

Make code more <mark style="background: #AD21D9;">compact</mark>  

Manage visual appearance of many components with one style

### <mark style="background: #AD21D9;">Styles Reduce Clutter:</mark>

```XML
<TextView  
	android:layout_width="match_parent"  
	android:layout_height="wrap_content  
	android:textColor="#00FF00"  
	android:typeface="monospace"  
	android:text="@string/hello" 
/>  
<TextView  
	style="@style/CodeFont"  
	android:text="@string/hello"  
/>
```

### <mark style="background: #AD21D9;">Defined in styles.xml</mark>

``styles.xml`` is in ``res/values``

```SQL
<resources>  
	<style name="CodeFont">  
		<item name="android:textColor">#00FF00</item>  
		<item name="android:typeface">monospace</item>  
	</style>  
</resources>
```

### <mark style="background: #AD21D9;">Inheritance: Parent</mark>

Define a parent style...

```XML
<resources>  
	<style name="CodeFont">  
		<item name="android:layout_width">match_parent</item>  
		<item name="android:layout_height">wrap_content</item>  
		<item name="android:textColor">#00FF00</item>  
		<item name="android:typeface">monospace</item>  
	</style>  
</resources>
```

### <mark style="background: #AD21D9;">Inheritance: Define Child:</mark>

Define child with Codefont as parent

```XML
<resources>  
	<style name="RedCode" parent="@style/Codefont">  
		<item name="android:textColor"> #FF0000 </item>  
	</style>  
</resources>
```

### <mark style="background: #AD21D9;">Themes:</mark>

A Theme is a style applied to an entire activity or even the entire app  

Themes are defined in styles.xml and may be customised  

```XML
<style name="AppTheme" parent="Theme.AppCompat.Light.DarkActionBar">  
<!-- Customise your theme here. -->  
	<item name="colorPrimary">@color/colorPrimary</item>  
	<item name="colorPrimaryDark">@color/colorPrimaryDark</item>  
	<item name="colorAccent">@color/colorAccent</item>  

</style>
```

### <mark style="background: #AD21D9;">Colours:</mark>

A colour value can be defined in XML.  

The colour is specified with an RGB value and alpha channel.  

You can use a colour resource any place that accepts a hexadecimal colour value.  

Value always begins with # character and then the Alpha-Red-Green-Blue info e.g. ``#RGB``

<mark style="background: #AD21D9;">Colour Example:</mark>
```XML
<resources>  
	<color name="colorPrimary">#008577</color>  
	<color name="colorPrimaryDark">#00574B</color>  
	<color name="colorAccent">#D81B60</color>  
</resources>
```

### <mark style="background: #AD21D9;">Strings:</mark>

<mark style="background: #AD21D9;">Strings.xml:</mark>

```XML
<resources>  
	<string name="hello">Hello!</string>  
</resources> 
```

<mark style="background: #AD21D9;">Layout:</mark>
```XML  
<TextView  
	android:layout_width="fill_parent"  
	android:layout_height="wrap_content"  
	android:text="@string/hello"  
/>
```

### <mark style="background: #AD21D9;">Refer to resources in code:</mark>

```XML  
XML: @drawable/filename  
<ImageView  
	android:layout_height="wrap_content"  
	android:layout_width="wrap_content"  
	android:src="@drawable/myimage"/>  
```

```Java
Java: R.drawable.filename  

Resources res = getResources();  
Drawable drawable = res.getDrawable(R.drawable.myimage);
```

<mark style="background: #AD21D9;">Layout:</mark>
```Kotlin
setContentView(R.layout.activity_main);
```

<mark style="background: #AD21D9;">View:</mark>
```Kotlin
rv = (RecyclerView) findViewById(R.id.recyclerview);
```

<mark style="background: #AD21D9;">String:</mark>
```Java
//Java
R.string.title
```

```XML
android:text="@string/title"
```

1. Get a EditText object for the EditText View  
```Kotlin
EditText simpleEditText = findViewById(R.id.edit_simple);
```  
2. Retrieve the CharSequence and convert it to a string  
```Kotlin
String strValue =  simpleEditText.getText().toString();
```

### <mark style="background: #AD21D9;">Measurements:</mark>

Devices have different screen sizes (handsets, tablets, TVs...)  

Different pixel sizes e.g. 160 or 480 per square inch.  

If you don't consider this, system might:  
- Scale your images (resulting in blurry images).  
- Images might appear at the completely wrong size.

A View defined as  "100px" wide will appear much larger on the left device.

![](https://i.imgur.com/8a4caoN.png)

For good graphics quality across devices, provide multiple versions of each bitmap in your app.

![](https://i.imgur.com/L9uaxre.png)

<mark style="background: #AD21D9;">dp:</mark>
- 1 dp is a virtual pixel unit, roughly equal to 1 pixel on a medium-density screen (160dpi; the "baseline" density).  
- Android translates dps to the number of real pixels for each other density using this formula:  
- ``px = dp * (dpi / 160)``

<mark style="background: #AD21D9;">sp:</mark>
- When defining text sizes you should instead use scalable pixels (sp) as your units (but never use sp for layout sizes).  
- The sp unit is the same size as dp, by default, but it resizes based on the user's preferred text size.

<mark style="background: #AD21D9;">Guidelines:</mark>
- Density-independent Pixels (dp): for Views  
- Scalable Pixels (sp): for text  

<mark style="background: #AD21D9;">Don't use device-dependent or density-dependent units:</mark>  
- Actual Pixels (px)  
- Actual Measurement (in, mm)  
- Points - typography 1/72 inch (pt)

# <mark style="background: #AD21D9;">03 listView and RecyclerView</mark>

### <mark style="background: #AD21D9;">What is a list view?:</mark>

A <mark style="background: #AD21D9;">ViewGroup</mark> that displays scrollable items

![](https://i.imgur.com/O5BuZnL.png)

![](https://i.imgur.com/ReiW8kR.png)

<mark style="background: #AD21D9;">Three Parts of a ListView:</mark>
- The ``ListView`` itself (aka a ``ViewGroup``)  
- List items (Each row/item in the list. Each item is a layout consisting of a View or ``ViewGroup``.)  
- Data for each item

### <mark style="background: #AD21D9;">ListItem:</mark>

Since the ``ListItem`` can be a ``ViewGroup``, we have the power to display very simple or extremely complex layouts for each item.  
- A ``TextView``  
- A ``TextView`` and ``ImageView``  
- A ``TextView`` and ``CheckBox``  
- A ``TextView`` and ``Button``  
- A ``TextView``, ``ImageView``, ``CheckBox``, ``Button``, and ``RatingBar``, etc

### <mark style="background: #AD21D9;">Where does the Data come from?</mark>

``ListViews`` receive data via <mark style="background: #AD21D9;">Adapters</mark>.  

The <mark style="background: #AD21D9;">Adapter</mark> behaves as the middleman between the data source and the ``ListView``.

<mark style="background: #AD21D9;">The job of an Adapter:</mark>  
- The <mark style="background: #AD21D9;">Adapter</mark> fetches data from the source.  
- Creates the layout that represents each list item.  
- Takes the data fetched from the source places it into the list item layout.  
- Returns a list item to the ``ListView``.

### <mark style="background: #AD21D9;">How an adapter works:</mark>

```Kotlin
Array<String> mMovies = { "Inception", "Spider Man", "Shawshank Redemption", "Fast and Furious",  "The Terminal" }
```

![](https://i.imgur.com/Oernst8.png)

<mark style="background: #AD21D9;">Data source for Adapters:</mark>
1. Arrays  
2. Content Provider - Used to get Calendar and Contact info from phone.  
3. Database Cursor

### <mark style="background: #AD21D9;">Types of Adapters:</mark>

<mark style="background: #AD21D9;">ArrayAdapter:</mark>  
- Works with Arrays  
- Can handle any Java Object as input  
- Uses the ``.toString()`` method of the ``JavaObject`` to obtain text for list item.  

<mark style="background: #AD21D9;">SimpleCursorAdapter:</mark>  
- Works with a Content Provider and Database Cursor

### <mark style="background: #AD21D9;">AdapterView:</mark>

``ListView`` derives from ``AdapterView``  

``AdapterViews`` are Views that use Adapters.  

There are several other ``AdapterView`` subclasses that behave much like ``ListView``.

<mark style="background: #AD21D9;">Subclasses of AdapterView:</mark>
1. AdapterViewFlipper  
2. GridView  
3. Spinner  
4. Gallery  
5. StackView  
6. ExpandableListView

### <mark style="background: #AD21D9;">Modifying your List:</mark>

<mark style="background: #AD21D9;">How do I add more items?</mark>  
``add(T Object)`` – Adds the specified object to the end  of the array.  

<mark style="background: #AD21D9;">How can I add a set of items?</mark>  
``addAll(T... items)`` – Adds the specified items at the end of the array.  

<mark style="background: #AD21D9;">How do I clear all items?</mark>  
``clear()`` – Remove all elements from the list

![](https://i.imgur.com/0A6bvdy.png)

### <mark style="background: #AD21D9;">ListActivity:</mark>

Useful when your Activity only supports a <mark style="background: #AD21D9;">single</mark> list.  

``ListActivity`` was designed to simplify the handling of ``ListViews``.

<mark style="background: #AD21D9;">Standard ListActivity:</mark>
- ``ListActivity`` has a default layout that consists of a single full-screen list in the centre of the screen.  
- ``ListActivity`` does not require that you assign it a layout resource via ``setContentView()``. ``ListActivity`` handles that for you.

<mark style="background: #AD21D9;">Custom ListActivity:</mark>
- If you want to include more views than just a ``ListView`` in your Activity, you may call ``setContentView()`` yourself with your own layout.  
- In this case, your layout <mark style="background: #AD21D9;">MUST</mark> contain a ``ListView`` with the ``android:id`` attribute  set to ``@android:id/list``

<mark style="background: #AD21D9;">ListActivity helper methods:</mark> 
- List Item Click events  
- Setting the ``ListView``’s adapter

<mark style="background: #AD21D9;">ListActivity click handling:</mark>
- When using a ``ListActivity``, you don’t need to implement an ``onItemClickListener()``.  
- ``ListActivity`` already implements one for you.  
- Simply @Override ``ListActivity``’s ``onListItemClick()`` to handle list click events.

<mark style="background: #AD21D9;">Setting the ListView's adapter with ListActivity:</mark>
- ``ListActivity`` provides the ``setListAdapter()`` method.  
- Internally calls ``setAdapter()`` on the ``ListView`` for the ``ListActivity``

<mark style="background: #AD21D9;">Initial impression of ListView:</mark>
- The ListView probably creates a view for each list item and only displays the item currently on screen.

<mark style="background: #AD21D9;">Example:</mark>

```Kotlin
Array<String> mMovies = { "Bill and Ted's Excellent Adventures", "Teen Wolf", "Honey I shrunk the kids","Texas Chainsaw Massacre", "Puppet Master", "Land Before Time", "TMNT", "Weird Science", "Goonies", "Total Recall", "Howard the duck", "Kindgergarden Cop", "Bloodsport", "Universal Soldier", "Ernest scared stupid", "Dumb and Dumber", "Breakfast Club" };
```

![](https://i.imgur.com/WeIEt08.png)

![](https://i.imgur.com/4hHmA9W.png)

<mark style="background: #AD21D9;">ListView recycles its items:</mark>
- To cut down on View Objects, a ``ListView`` will only allocate enough Item Views to “roughly” fill the size of a ``ListView``. 
- When an item gets scrolled off the ``ListView``, its view will be reused by a new Item that is scrolling on to the ``ListView``.
![](https://i.imgur.com/NaYjeZo.png)


<mark style="background: #AD21D9;">ListView Recylcing:</mark>
- Automatically taken care of by the ``ListView`` when using a standard ``ArrayAdapter``.  
- However, if you implement your own Adapter you’ll have to do a little work.

### <mark style="background: #AD21D9;">Adapters:</mark>

Lets look at how the ``ArrayAdapter`` class does the following:  
1. Creates list item Views  
2. Recycles list item Views

### <mark style="background: #AD21D9;">How an adapter works:</mark>

```Kotlin
Array<String> mMovies = { "Bill and Ted's Excellent Adventures", "Teen Wolf", "Honey I shrunk the kids", "Texas Chainsaw Massacre", "Puppet Master" }
```

![](https://i.imgur.com/jYnO4jA.png)

![](https://i.imgur.com/ixlx7cK.png)

![](https://i.imgur.com/pxr4yKu.png)

![](https://i.imgur.com/FtJFByg.png)

![](https://i.imgur.com/Gwr9PJT.png)

### <mark style="background: #AD21D9;">Implementing your own adapter:</mark>

The default look and feel of the Android ``ListView`` is not very attractive.  

Also, remember the default action of an ``ArrayAdapter`` is to call the ``toString()`` method on the data object it contains.  

This means your list will change the text on the list item and nothing else.

<mark style="background: #AD21D9;">Getting creative with Custom Adapters:</mark>  
- With Custom Adapters, you can use your own layout to make lists more interesting.  
- You can make the list items look any way you want.  
- You can make the list item have more data than just simple text.

<mark style="background: #AD21D9;">Steps for create a custom adapter:</mark>  
1. Extend an existing Adapter class  
2. Define a constructor  
3. @Override the Adapter’s ``getView()`` method.  
	- Use this to inflate custom list items  
	- Use this to populate the item with more data than just what comes from ``toString()``

<mark style="background: #AD21D9;">Extend an existing Adapter:</mark>
- Create a class that extends  
	1. BaseAdapter  
	2. ArrayAdapter  
	3. SimpleCursorAdapter  
- You’ll want to extend an existing adapter because they provide quite a bit of  functionality that we don’t want to rewrite ourselves.

### <mark style="background: #AD21D9;">Recycler view overview:</mark>

Recycler view is a robust list drawing library that provides a fixed size window we can use to load a large dataset into.  

It recycles the views it creates as we scroll (or the views go out of scope) and then if there is a need, it reuses them to make it seem as if the views were never offloaded.  

They appear to the user to be present outside the window.  

This makes Recycler view exceptional for displaying data collections whose elements change at runtime based on user action or network events.

``RecyclerView`` supports three types of lists using ``RecyclerView.LayoutManager``.  
- ``StaggeredGridLayoutManager``  
- ``GridLayoutManager``  
- ``LinearLayoutManager``

``RecyclerViews`` are generally used to show a scrolling list of items in either a list or grid format.  

As items in a list or grid can look different in different applications or even in different activities belonging to the same application.  

You’ll be required to not only add in a recycler view but also to tell the recycler view how to add in and display items.  

``RecyclerViews`` take a bit of work to get up and running because of this but they are highly flexible and adaptable as a result.


# <mark style="background: #AD21D9;">04 Activity Lifecycle</mark>

### <mark style="background: #AD21D9;">Activity Life in Android Applications:</mark>

Manifest File  

Activity Lifecycle  
- Callbacks  
- Instance State  
- Saving and Restoring Activity State

### <mark style="background: #AD21D9;">Introduction:</mark>

Every app project must have an AndroidManifest.xml file.  

It lives at the root of the project source set.  

<mark style="background: #AD21D9;">Describes essential information about your app to:</mark>  
1. Android Build Tools  
2. Android Operating System  
3. Google Play

### <mark style="background: #AD21D9;">Location:</mark>

![](https://i.imgur.com/EwHJqBg.png)

### <mark style="background: #AD21D9;">Rules:</mark>
1. Only ``<manifest>`` and ``<application>`` elements are required. (Must occur only once.) 
2. Most other elements can occur 0 or more times. 
3. All values are set through attributes. 
4. Elements at same level are generally not ordered.

### <mark style="background: #AD21D9;">Example:</mark>
```XML
<?xml version="1.0" encoding="utf-8"?>  
<manifest >  
	<application  
	android:theme = "@style/AppTheme">  
		<activity android:name = ".ActivityA">  
			<intent-filter>  
			</intent-filter>  
		</activity>  
		<activity />  
		<activity />  
	</application>  
</manifest>
```

### <mark style="background: #AD21D9;">Contents:</mark>

Things found inside the manifest file include:
1. <mark style="background: #AD21D9;">Package name:</mark> Used to find pieces of code when building your project.  
2. <mark style="background: #AD21D9;">Components:</mark> (e.g. Activities) Each component must define basic properties e.g. name of Java/Kotlin class.   
3. <mark style="background: #AD21D9;">Capabilities:</mark> Device configurations it can handle and Intent filters (start-up).  
4. <mark style="background: #AD21D9;">Permissions:</mark> For App to access protected parts of the system or other apps.  
5. <mark style="background: #AD21D9;">Features required:</mark> Affects which devices can install the app from Google Play

### <mark style="background: #AD21D9;">Package Name:</mark>

The manifest file's <mark style="background: #AD21D9;">root</mark> element requires an <mark style="background: #AD21D9;">attribute</mark> for your app's package name:

```XML
<manifest xmlns:android = "http://schemas.android.com/apk/res/android" package = "com.example.lifecycle">
```

When building the APK, the package attribute is important e.g. as <mark style="background: #AD21D9;">namespace</mark> for generated R class ``com.example.lifecycle.R``  

It also resolves <mark style="background: #AD21D9;">relative</mark> class names declared in the manifest file e.g. ``com.example.lifecycle.ActivityA``

### <mark style="background: #AD21D9;">Permissions:</mark>

Android apps must <mark style="background: #AD21D9;">request</mark> permission to access:  
- <mark style="background: #AD21D9;">Sensitive</mark> user data (contacts and SMS)  
- Certain system features (<mark style="background: #AD21D9;">camera</mark> and network connection)  

Permissions are requested with a ``<uses-permission>`` <mark style="background: #AD21D9;">element</mark> and identified by a unique label e.g.to send SMS messages

```XML
<uses-permission android:name = "android.permission.SEND_SMS"/>
```

Beginning with API level 23, the user can approve or reject some app permissions at <mark style="background: #AD21D9;">runtime</mark>.  

If the permission is <mark style="background: #AD21D9;">granted</mark>, the app is able to use the protected features. If not, its attempts to access those features <mark style="background: #AD21D9;">fail</mark>.

### <mark style="background: #AD21D9;">App Components:</mark>

For each app component in your app, declare an XML element:  
- Activity  ``<activity>``
- Service  `<service> `
- BroadcastReceiver  `<receiver>`
- ContentProvider  `<provider>`
 
If you <mark style="background: #AD21D9;">subclass</mark> these components without declaring it in the manifest file, the system cannot start it.

When an app issues an <mark style="background: #AD21D9;">Intent</mark> to the system, it locates an app component that can handle it based on ``<intent-filter>`` declarations  
in each app's manifest file.

### <mark style="background: #AD21D9;">Device Compatibility:</mark>

Play Store does not allow app be installed on devices that don't provide required features.  

Hardware or software features your app requires are declared with ``<uses-feature>`` element.

```XML
<uses-feature android:name = "android.hardware.sensor.compass" android:required = "true" />
```

### <mark style="background: #AD21D9;">Activity Lifecycle:</mark>

![](https://i.imgur.com/8TKF5Me.png)

### <mark style="background: #AD21D9;">What is the activity lifecycle?</mark>

The set of <mark style="background: #AD21D9;">states</mark> an Activity can be in during its lifetime, from when it is created <mark style="background: #AD21D9;">until</mark> it is destroyed  

<mark style="background: #AD21D9;">In Google Speak:</mark>  
- A directed graph of all the states an Activity can be in, and the <mark style="background: #AD21D9;">callbacks</mark> associated with transitioning from each state to the next one

![](https://i.imgur.com/yM3OhNJ.png)

<mark style="background: #AD21D9;">States:</mark> Lifecycle state changes are <mark style="background: #AD21D9;">triggered</mark> by user action, configuration changes such as device rotation, or system action.

### <mark style="background: #AD21D9;">Activity Lifecycle Callbacks:</mark>

Only ``onCreate()`` is <mark style="background: #AD21D9;">required</mark>.  

Override the other callbacks to change <mark style="background: #AD21D9;">default</mark> behaviour

### <mark style="background: #AD21D9;">On Create:</mark>

```Kotlin
@Override  
public void onCreate(Bundle savedInstanceState){  
super.onCreate(savedInstanceState);  
// Activity is being created.  
}
```
Called when Activity is first created e.g. user hits <mark style="background: #AD21D9;">launcher</mark> icon.  

Does all <mark style="background: #AD21D9;">static</mark> setup: create views, bind data to lists...  

Only called <mark style="background: #AD21D9;">once</mark> during an activity's lifetime.  

Takes a <mark style="background: #AD21D9;">bundle</mark> with Activity's previously frozen state, if exists.  

Created state is always followed by ``onStart()``

### <mark style="background: #AD21D9;">On Start:</mark>

```Kotlin
@Overrideprotected void onStart() 
{  
	super.onStart();  
	// Activity is about to become visible.  
}
```

Called when the Activity is becoming <mark style="background: #AD21D9;">visible</mark> to user.  

Can be called <mark style="background: #AD21D9;">more than once</mark> during lifecycle.  

Followed by ``onResume()`` if the activity comes to the foreground, or ``onStop()`` if it becomes hidden.

### <mark style="background: #AD21D9;">On Restart:</mark>

```Kotlin
@Override  
protected void onRestart() {  
	super.onRestart();  
// Activity is between stopped and started.  
}
```
Called after Activity has been <mark style="background: #AD21D9;">stopped</mark>, immediately before it is started again.  
- Transient state.  
- Always followed by ``onStart()``.

### <mark style="background: #AD21D9;">On Resume:</mark>

```Kotlin
@Override protected void onResume() 
{  
	super.onResume();  
	// Activity has become visible, it is now "resumed"  
}
```
Called when Activity will start interacting with user.  
Activity has moved to top of the Activity Stack.  

Starts accepting user input.  

Running state.  

Always followed by ``onPause()``.

### <mark style="background: #AD21D9;">On Pause:</mark>

```Kotlin
@Override protected void onPause() 
{  
	super.onPause();  
	// Another activity is taking focus, this one is about to be "paused"  
}
```

Called when system is about to resume a previous Activity.  

Activity is partly visible but user is leaving the Activity.  

Typically used to commit unsaved changes to persistent data, stop animations and anything that <mark style="background: #AD21D9;">consumes resources</mark>.

Implementations must be fast because <mark style="background: #AD21D9;">next</mark> Activity is not resumed <mark style="background: #AD21D9;">until</mark> this method <mark style="background: #AD21D9;">returns</mark>.  

Followed by either ``onResume()`` if the Activity returns back to the front or ``onStop()`` if it becomes invisible to the user.

### <mark style="background: #AD21D9;">On Stop:</mark>

```Kotlin
@Override protected void onStop() 
{  
	super.onStop();  
	// Activity is no longer visible it is now "stopped"  
}
```
Called when the Activity is no longer <mark style="background: #AD21D9;">visible</mark> to the user.  

A <mark style="background: #AD21D9;">new</mark> Activity is being started, an existing one is brought in front of this one, or this one is being destroyed.  

Operations that were too heavy-weight for ``onPause()``  

Followed by either ``onRestart()`` if Activity is <mark style="background: #AD21D9;">coming back</mark> to interact with user, or ``onDestroy()`` if Activity is <mark style="background: #AD21D9;">going away</mark>.

### <mark style="background: #AD21D9;">On Destroy:</mark>

```Kotlin
@Override protected void onDestroy() 
{  
	super.onDestroy();  
	// Activity is about to be destroyed.  
}
```
<mark style="background: #AD21D9;">Final</mark> call before Activity is destroyed.  

User navigates <mark style="background: #AD21D9;">back</mark> to previous Activity, or configuration changes.  

Activity is <mark style="background: #AD21D9;">finishing</mark> or system is destroying it to save space.  

Call ``isFinishing()`` method to check.  

The system may destroy Activity without calling this, so use ``onPause()`` or ``onStop()`` to save data or state.

![](https://i.imgur.com/j9orZ8w.png)

### <mark style="background: #AD21D9;">App Visibility:</mark>

- Created (not visible yet)  
- Started (visible)  
- Resume (visible)  
- Paused(partially invisible)  
- Stopped (hidden)  
- Destroyed (gone from <mark style="background: #AD21D9;">memory</mark>)

### <mark style="background: #AD21D9;">Summary:</mark>

``onCreate()`` - Static initialisation  
``onStart()`` - Activity is becoming visible  
``onRestart()`` - If Activity was stopped (calls ``onStart()``)  
``onResume()`` - Start to interact with user  
``onPause()`` - About to resume previous Activity  
``onStop()`` - No longer visible, but still exists and <mark style="background: #AD21D9;">all state</mark> info preserved  
``onDestroy()`` - Final call before System destroys Activity

# <mark style="background: #AD21D9;">05 Intents</mark>

![](https://i.imgur.com/YoZlMzc.png)

### <mark style="background: #AD21D9;">Topics:</mark>

- Intents (Implicit, Explicit)  
- Passing Data  
- Permissions  
- Navigation

### <mark style="background: #AD21D9;">Application Structure:</mark>

Due to the limited screen space of devices applications are structured as a collection of activities connected by intents  

Activities take up a full screen and are responsible for displaying a UI and interacting with the user  

Intents are responsible for launching and returning from activities and communicating data between the two  

### <mark style="background: #AD21D9;">Activities:</mark>

All applications in Android are required to use the full screen of the device. This has two effects  
- gives the largest space possible for displaying a UI 
- takes full control of the CPU to give the fastest response time  

If it is not possible to use a single activity to represent the full functionality of the application then there needs to be a mechanism to transfer from one to another

### <mark style="background: #AD21D9;">What is an intent?</mark>

Intents are objects that provide the language/description of an operation to be performed.  

An Intent (your intention for the app) is constructed by the activity that wants some work done. Received by another activity that can perform that work.

![](https://i.imgur.com/BcpJdCP.png)

![](https://i.imgur.com/Z3V6nCg.png)

### <mark style="background: #AD21D9;">Intents:</mark>

Used to link from one activity to the next  

An intent asks the android system to start a new activity for this application  

Intents can also have data attached to them to either seed the new activity or contain results to be returns from an activity  

<mark style="background: #AD21D9;">However, there are two different classes of intent:</mark>  
- Explicit  
- Implicit

### <mark style="background: #AD21D9;">Two Flavours: Implicit and Explicit:</mark>

<mark style="background: #AD21D9;">Explicit</mark>  
- Navigation – Launch a specific activity  
- ``Intent(Context packageContext, Class <?> cls)``  

Create an intent for a specific activity. Pass intent to ``startActivity()`` method.

<mark style="background: #AD21D9;">Implicit:</mark>
- Specify what you want done and the System chooses the app for you  
	- ``Intent(String action)``  
	- ``Intent(String action, Uri uri)``  
- Create an Intent with action. Or create Intent with action and other parameters such as Data  in the form of Uri Pass intent to ``startActivity()`` method

### <mark style="background: #AD21D9;">Explicit Intent:</mark>

An explicit intent is one where you know the fully qualified name of the activity you wish to start.  

Generally, you will use this to refer to activities that are in your own application  

Or if there is an external application you use where you know the fully qualified name of the activity to start

### <mark style="background: #AD21D9;">Implicit Intent:</mark>

An implicit intent is one where you have data you need to display or interact with however, you do not know how to do this  

With such an intent android will try to find another external application that is capable of rendering the content or interacting with it  

Thus there is the possibility that a compatible application may not be present  

This has implications for application design

From an OS perspective, applications are expected to do a single job and do it well.  

If they need support for different types of data then they should hand that to a separate application instead of self-implementing  

The idea is that by removing duplicate functionality applications are small, bug-free, and integrate with each other.  

Thus if you need some common functionality to try linking up to another application  

Reduces the amount of code you need to write and increases reliability.

### <mark style="background: #AD21D9;">Start - Explicit Way:</mark>

If you know the name of the Activity, use an Explicit Intent  
1. Create an Intent  
2. Use the Intent to start the Activity– Method call is ``startActivity()`` (Code taken from ``HelloAndroidWithLogin``)

```Kotlin
// Create an explicit Intent for starting the HelloAndroid Activity  
//need context and the calling class for Constructor  
val helloAndroidIntent = Intent(this,HelloWorld::class.java)  
// Use the Intent to start the HelloAndroid Activity  
startActivity(helloAndroidIntent)
```

### <mark style="background: #AD21D9;">Class Demo HelloAndroidWithLogin:</mark>

``LoginScreen`` Activity calls ``HelloAndroid`` Activity  
Code Available on BrightSpace
![](https://i.imgur.com/EEqQEu6.png)

### <mark style="background: #AD21D9;">Activity Manifest:</mark>

All Activities must be registered in the Activity Manifest to be launched  

For the activity launcher to start an activity, the  
activity needs to be registered in the Android  
manifest with the correct intent filter  

Activities that are launched explicitly must also be declared in the Manifest file

Review the ``HelloAndroidWithLogin`` code

![](https://i.imgur.com/FTLBxJS.png)

### <mark style="background: #AD21D9;">Start - Implicit Way:</mark>

To ask Android to find an Activity to handle your request, use an implicit Intent  
1. <mark style="background: #AD21D9;">Create an Intent:</mark> Constructor take a String Action and Data Value specified as a URI  
2. Use the Intent to <mark style="background: #AD21D9;">start the Activity</mark> i.e. Google Maps

```Kotlin
Intent(String action, Uri uri)  
// Create an Intent with action and Data.  
Intent geoIntent = new  
Intent(android.content.Intent.ACTION_VIEW,  
Uri.parse("geo:0,0?q=" + address));  
//It takes two parameters: an action value specified  
//as a String and a data value specified as a URI  
startActivity(geoIntent)
```

### <mark style="background: #AD21D9;">Class Demo:</mark>

MapLocation  

Implicit Intents: - start Google Maps  

Constructor Values found at https://developer.android.com/guide/components/intents-common

![](https://i.imgur.com/j63tV23.png)

### <mark style="background: #AD21D9;">Implicit Intents - Examples of String Actions:</mark>

Each implicit intent must have an action 

The action describes what must be done  

Common actions are view, edit or dial  

In addition to actions, an intent has other fields such as datatype, category, URI  

Look at the ``ImplicitIntents`` Code

![](https://i.imgur.com/m2ShnvJ.png)

### <mark style="background: #AD21D9;">Intent Resolution - Implicit Intent</mark>

Illustration of how an implicit intent is delivered through the system to start another activity: 
1. Activity A creates an Intent with an action description and passes it to ``startActivity()`` 
2. The Android System searches all apps for an intent filter that matches the intent. 
3. When a match is found the system starts the matching activity (Activity B) by invoking its ``onCreate()`` method and passing it the Intent.  
Ref:  http://developer.android.com/guide/components/intents-filters.html

### <mark style="background: #AD21D9;">Example of Google Maps Intent Filter:</mark>

As you already know, the ``MapLocation`` application got ``GoogleMaps`` to do its work, i.e. to show an address on a Map. 

The Intent filter specified in the Google Map application would have been similar to the following:

```XML
<intent-filter...>  
<action android:name="android.intent.action.VIEW"/>  
<category android:name="android.intent.category.DEFAULT"/>  
<category android:name="android.intent.category.BROWSABLE"/>  
<data android:scheme="geo”/>  
<intent-filter>
```

Action: ACTION_VIEW  

Categories: DEFAULT, BROWSABLE  

Data: URIs with the geo scheme This means that the component can be used to display geographical locations to the user, and it can be launched from a web browser or by other apps using an implicit intent with the ACTION_VIEW action and a geo URI.  
- Example If an app sends an implicit intent with the ACTION_VIEW action and a URI like geo:0,0?q=TUD+Dublin+Ireland, the system will search for components with an intent filter that matches these criteria.  
- If the provided intent filter is present in an activity's manifest, that activity will be considered a candidate to handle the intent.

### <mark style="background: #AD21D9;">Permissions:</mark>

The Implicit Intents example needed a permission for the timer. This permission is placed in the Manifest file  
```Kotlin
<uses-permission android:name="com.android.alarm.permission.SET_ALARM" />
```  

Android permissions control an app’s access to user data and device features.  

They ensure apps only access the data they need to function.  

Protect user privacy and prevent unauthorized access.

<mark style="background: #AD21D9;">Normal Permissions: (Set Timer)</mark>  
- Grant access to less sensitive information (e.g., Internet).  
- Automatically granted by the system.  

<mark style="background: #AD21D9;">Dangerous Permissions:</mark>  
- Access more sensitive data (e.g., location, camera).Require explicit user approval.

### <mark style="background: #AD21D9;">Sending and Receiving Data with Intents:</mark>

<mark style="background: #AD21D9;">putExtra()</mark> – for passing data  

<mark style="background: #AD21D9;">Data</mark> - Data can be added to an intent object before it is started via the ``putExtra()`` method. Data is added in the form of key-value pairs. Data (Username) was passed from the Login Screen to the ``HelloAndroid`` Screen in the ``HelloAndroidWithLogin`` code.

```Kotlin
// Use the Intent to start the HelloAndroid Activity  
//add text  
helloAndroidIntent.putExtra("UserName", uname.text.toString())  
startActivity(helloAndroidIntent)
```

### <mark style="background: #AD21D9;">How it works: A passing to B:</mark>

<mark style="background: #AD21D9;">In Activity A (sender);</mark>  
- Create the Intent object  
- Put data into that Intent  
- Start the new Activity with startActivity()  

<mark style="background: #AD21D9;">In Activity B (receiver):</mark>  
- Get the Intent object that Activity was started with  
- Retrieve the data or extras from the Intent object

### <mark style="background: #AD21D9;">Navigation:</mark>

<mark style="background: #AD21D9;">Activity Stack:</mark>  
- When a new Activity is <mark style="background: #AD21D9;">started</mark>, the previous Activity is <mark style="background: #AD21D9;">stopped</mark> and pushed on the Activity back stack  
- <mark style="background: #AD21D9;">Last In First Out</mark> Stack - when the current Activity ends, or the user presses the Back button, it is popped from the stack and the previous Activity resumes

### <mark style="background: #AD21D9;">Back Navigation:</mark>
- Provided by the device's Back button  
- Controlled by the Android System's back 
- Back Stack preserves the history of recently viewed screens. 
- Back Stack contains all the Activity objects that have been launched by the user in reverse order for the current task  
- Each task has its own Back Stack  
- Switching between tasks activates that task's backstack

# <mark style="background: #AD21D9;">06 Room</mark>

Android <mark style="background: #AD21D9;">ROOM</mark> is for Storing Permanent data

### <mark style="background: #AD21D9;">Annotations</mark>

Annotations provide information about your program (classes, methods, fields) accessible to processing by <mark style="background: #AD21D9;">external tools</mark>.

Similar to <mark style="background: #AD21D9;">modifier</mark> (e.g. public or static), should appear on own line before other modifiers.

Indicated by an <mark style="background: #AD21D9;">@</mark> character followed by name of annotation type.

### <mark style="background: #AD21D9;">Example:</mark>

Keeping track of <mark style="background: #AD21D9;">code reviews</mark>

Annotations allow you to provide review information e.g. reviewer name, date

```Kotlin
@Reviewed(reviewer = "Abubakr Siddig", date = 20231024)
class MyClass {
	// ...
}
```

Values are supplied for elements of annotation type e.g. reviewer = “Abubakr Siddig”

Tool can then automatically <mark style="background: #AD21D9;">extract</mark> these values from either source file, or (more often) compiled class file. e.g. determine whether a class has been reviewed since it was last <mark style="background: #AD21D9;">modified</mark>.

![](https://i.imgur.com/l3lP0Mv.png)


### <mark style="background: #AD21D9;">Overview:</mark>

ROOM is a robust SQL <mark style="background: #AD21D9;">object</mark> mapping library

Generates <mark style="background: #AD21D9;">SQLite</mark> Android code

Provides a <mark style="background: #AD21D9;">simple</mark> API for your database

Offers layer over SQLite for smooth database access while harnessing full power of SQLite.

Apps that handle reasonable amounts of structured data can benefit greatly from storing that data <mark style="background: #AD21D9;">locally</mark>.

Most common use case is <mark style="background: #AD21D9;">caching</mark> relevant pieces of data i.e. when device cannot access network, user can still browse content <mark style="background: #AD21D9;">offline</mark>

User-initiated content changes <mark style="background: #AD21D9;">synced</mark> to server after device is back online.

As ROOM takes care of these concerns for you, it is highly <mark style="background: #AD21D9;">recommended</mark> using ROOM instead of SQLite.

### <mark style="background: #AD21D9;">Modern Android:</mark>

![](https://i.imgur.com/YX2UnIe.png)


### <mark style="background: #AD21D9;">Components:</mark>

<mark style="background: #AD21D9;">3 major components in ROOM:</mark>
- <mark style="background: #AD21D9;">Entity</mark> Represents table within database.
- <mark style="background: #AD21D9;">Database</mark> Contains database holder and serves as main access point for underlying connection to app's stored, relational data.
- <mark style="background: #AD21D9;">Data Access Objects (DAO):</mark> Contains methods used for accessing database.

![](https://i.imgur.com/RQr5BIW.png)

![](https://i.imgur.com/JKV5dNj.png)

![](https://i.imgur.com/uYkCUgs.png)


### <mark style="background: #AD21D9;">Entities:</mark>

Sets of related fields are defined as entities.

For each entity, <mark style="background: #AD21D9;">table</mark> is created within database object to hold items.

By default, ROOM creates a <mark style="background: #AD21D9;">column</mark> for each field defined in entity.

To store a field, ROOM must have <mark style="background: #AD21D9;">access</mark> to it.

2 options make field <mark style="background: #AD21D9;">public</mark>, or you can provide a getter and setter.

![](https://i.imgur.com/69Uol6L.png)


<mark style="background: #AD21D9;">Entities can have:</mark>
- An <mark style="background: #AD21D9;">empty</mark> constructor
- Constructor whose parameters contain types and names that <mark style="background: #AD21D9;">match</mark> those of fields in entity.
- <mark style="background: #AD21D9;">Partial</mark> constructors, such as a constructor that receives only some of the fields.

### <mark style="background: #AD21D9;">Primary Key:</mark>

Each entity must define at least 1 field as primary key.

Even when only 1 field, must still be annotated with ``@PrimaryKey``.

To assign <mark style="background: #AD21D9;">automatic</mark> IDs, set ``@PrimaryKey's autoGenerate`` property.

If entity has <mark style="background: #AD21D9;">composite</mark> primary key, use the ``primaryKeys`` property of the ``@Entity`` annotation.

### <mark style="background: #AD21D9;">Names:</mark>

<mark style="background: #AD21D9;">By default</mark>, ROOM uses class name as database table name.

For different name, set ``tableName`` property of ``@Entity``

<mark style="background: #AD21D9;">Caution:</mark> table names in SQLite are <mark style="background: #AD21D9;">case-insensitive</mark>.

ROOM uses field names as <mark style="background: #AD21D9;">column</mark> names in database.

Again, for a different name, add ``@ColumnInfo`` annotation to field.

### <mark style="background: #AD21D9;">Example:</mark>

```Kotlin
@Entity
data class User(
	@PrimaryKey val uid: Int,
	@ColumnInfo(name = "first_name") val firstName: String?,
	@ColumnInfo(name = "last_name") val lastName: String?
)
```

### <mark style="background: #AD21D9;">@NonNull:</mark>

``@NonNull`` denotes parameter, field, or method return value can never be null

Use for mandatory fields

Primary key <mark style="background: #AD21D9;">must</mark> use ``@NonNull``

### <mark style="background: #AD21D9;">Data Access Objects:</mark>

To <mark style="background: #AD21D9;">access</mark> app's data we work with data access objects, or DAOs.

The set of DAO forms main component of Room, as each DAO includes methods that offer <mark style="background: #AD21D9;">abstract</mark> access to your app's database.

Why use DAO class instead of query builders or direct queries?
1. <mark style="background: #AD21D9;">Separate</mark> different components of your database architecture.
2. Easily <mark style="background: #AD21D9;">mock</mark> database access to test app.

A DAO can be either an <mark style="background: #AD21D9;">interface</mark> or <mark style="background: #AD21D9;">abstract</mark> class.

If abstract class, can optionally have constructor that takes a ``RoomDatabase`` as only parameter.

Room creates each DAO implementation at <mark style="background: #AD21D9;">compile</mark> time.

<mark style="background: #AD21D9;">Note:</mark> Room doesn't support database access on Main Thread unless ``allowMainThreadQueries()`` called on builder.

### <mark style="background: #AD21D9;">Insert:</mark>

When you create a DAO method and annotate it with ``@Insert``

Room generates an implementation that inserts all parameters into the database in a single transaction.

```Kotlin
@Dao
interface MyDao {
	@Insert
	fun insertUser(user: User)
	@Insert
	fun insertBothUsers(user1: User, user2: User)
}
```

### <mark style="background: #AD21D9;">Update:</mark>

Update method modifies a set of entities, given as parameters

It uses a query that matches against primary key of each entity.

```Kotlin
@Dao
interface MyDao {
	@Update
	fun updateUsers(vararg users: User);
}
```

### <mark style="background: #AD21D9;">Delete:</mark>

Delete convenience method removes a set of entities, given as parameters, from database.

It uses the primary keys to find the entities to delete.

```Kotlin
@Dao
interface MyDao {
	@Delete
	fun deleteUsers(vararg users: User);
}
```

### <mark style="background: #AD21D9;">Queries:</mark>

``@Query`` is main annotation used in DAO classes.

It allows you to perform read/write operations on database.

Each @Query method is verified at compile time i.e. if there is problem with query, ``compilation error`` occurs instead of ``runtime failure``.

Below is a query that loads all users.

At compile time, Room knows it is querying all columns in user table.

If query contains syntax error or user table doesn't exist

Room displays error with appropriate message as app compiles.

```Kotlin
@Dao

interface MyDao {
	@Query("SELECT * FROM user")
	fun getAll(): List<User>
}
```

Passing parameters into queries performs filtering operations e.g. as displaying only users who are older than a certain age.

```Kotlin
@Dao
interface MyDao {
	@Query("SELECT * FROM user WHERE age > :minAge")
	fun loadAllUsersOlderThan(minAge)
}
```

You can also pass multiple parameters in a query.

```Kotlin
@Dao
interface MyDao {
	@Query("SELECT * FROM user WHERE age BETWEEN :minAge AND :maxAge")
	fun loadAllUsersBetweenAges(minAge, maxAge)
}
```

### <mark style="background: #AD21D9;">More Examples:</mark>

```Kotlin
@Query("DELETE FROM word_table")
fun deleteAll()

@Query("SELECT * from word_table ORDER BY word ASC")
fun getAllWords()

@Query("SELECT * FROM word_table WHERE word LIKE :word ")
fun findWord(String word)
```

### <mark style="background: #AD21D9;">Database:</mark>

<mark style="background: #AD21D9;">The class annotated with @Database should:</mark>
1. Be <mark style="background: #AD21D9;">abstract</mark> class that extends ``RoomDatabase``.
2. Include list of <mark style="background: #AD21D9;">entities</mark> associated with database within annotation.
3. Contain abstract method with 0 arguments and return class annotated with ``@Dao``.

```Kotlin
@Database(entities = [Word::class], version = 1)
abstract class WordRoomDatabase : RoomDatabase () {
	abstract fun wordDao : WordDao
```

At <mark style="background: #AD21D9;">runtime</mark>, an instance of Database is obtained by calling: ``Room.databaseBuilder()`` with class and database name

```Kotlin
val INSTANCE = Room.databaseBuilder(context,
	WordRoomDatabase::class.java, "word_database"
	).build();
```

### <mark style="background: #AD21D9;">Summary:</mark>

Room works with DAO and Entities

Entities define the database schema

DAO provides methods to access database

![](https://i.imgur.com/QkOITsG.png)

# <mark style="background: #AD21D9;">07 Custom Views</mark>

### <mark style="background: #AD21D9;">Motivation:</mark>

At certain points during Android development, you will be required to develop a custom view
- Not everything you will require in terms of views will be provided by the SDK
- A lot of applications will have at least one custom view in their layouts and activities

Here we will discuss the various elements that will be required to make a fully working custom view

### <mark style="background: #AD21D9;">Why Custom Views?</mark>

The reason we require custom views is that the views provided by the SDK only cover the most common items that most if not all applications require.

Standard things like buttons, radio buttons, checkboxes, edit texts, etc

If the SDK was to provide for every single case, then it would be unfeasibly large

To combat this (like all other GUI toolkits) a base view is provided which you can extend and override to produce your own views.

### <mark style="background: #AD21D9;">Methods of making a custom view:</mark>

There are three methods of constructing a custom view in android listed here along with their probability of use
- <mark style="background: #AD21D9;">Method 1:</mark> subclass an already existing view (rare)
- <mark style="background: #AD21D9;">Method 2:</mark> Compose a view out of already existing views (rare)
- <mark style="background: #AD21D9;">Method 3:</mark> Do a full custom implementation (most likely)

### <mark style="background: #AD21D9;">Method 1 - Subclass an Existing View:</mark>

A good example of this is to extend the ``NumberPicker`` class to accept minimum and maximum values through XML

Depending on behaviour required you may need very little code

Rare chance that this can be done but very little effort when it can

If you only want to add a small piece of behaviour to an already existing view that can’t be set through attributes then this is the method to use.

### <mark style="background: #AD21D9;">Method 2: Compose out of existing views</mark>

Here you would combine multiple existing views to create a more complex view.

An example of this would be creating an edit text with a clear button (users find it frustrating to clear text by hand)

Here we compose a small custom layout that defines our view. Note that when using this approach the Layout must be subclassed not a view

Like method 1 this is rare but again very little code required if this can be used

### <mark style="background: #AD21D9;">Method 3 -Full Custom Implementation:</mark>

Most common form of writing custom views Requires a lot of mathematics and working with primitives

Mainly a trial-and-error process as the display can only be verified visually. Here you require a view that is not provided by the SDK, in this case you have to take a bare view class, subclass it, and do all the operations yourself.

### <mark style="background: #AD21D9;">Requirements for a custom view:</mark>

You must provide all the drawing operations (in the ``onDraw()`` method)

You must provide all interpretation of user touches on your view (if your view uses touch)

You must provide ways and means for your view to be customisable through attributes

There are a minimum set of requirements that must be satisfied if you want your custom view to work correctly.

### <mark style="background: #AD21D9;">Constructors:</mark>

When you subclass a view, you are required to implement three constructors each have a specific use case. Assuming our class is called ``CustomView`` we have the following
- ``CustomView(Context c)``
- ``CustomView(Context c, AttributeSet as)``
- ``CustomView(Context c, AttributeSet as, int def style)``

The first constructor is used when your custom view is directly initialised from java code
- Rarely used and not recommended
- The Context attribute is the context of the activity that will own this custom view
- Allows android to build an internal visual tree to manage event handling

The second constructor is used in the case where the custom view is added in XML and is constructed with the layout inflator:
- The AttributeSet holds the list of XML attributes that the caller wishes to set on this custom view
- You may accept as many attributes as you like
- Generally, a good idea to allow customisation through attributes as makes your view flexible

The third constructor is used when the caller applies a style to views within their XML layout
- Permits your view to apply that style to itself
- To enable better integration of your custom view into an application
- Requires the most work but great custom views are completely flexible if they are to be used elsewhere

### <mark style="background: #AD21D9;">Constructors: Recommended Practice:</mark>

It is recommended that when you go to implement these constructors that all common code between them is split into a shared method
- Basic bit of code refactoring. Write once, instead of three times
- Thus if you find a mistake in common behaviour you need only fix it once
- For our purposes we will call this method ``init()``

### <mark style="background: #AD21D9;">What should init() be used for?</mark>

Should be used for all items that are shared between all three constructors

Things like initialising colours, shapes, and any parameters or data structures that are relevant to your custom view

It is a good idea to initialise and construct all the objects required by your custom view here if you can

For performance reasons as will be discussed in the next slide

### <mark style="background: #AD21D9;">Why objects should be created in init() and not onDraw()</mark>

The reason why we create in ``init()`` is that ``init()`` will only be called once, ``onDraw()`` can potentially be called up to 60 times a second

This is because most displays use a refresh rate of 60Hz

If on each ``onDraw()`` call you allocate an object you potentially have a 120 allocate/deallocate events for that object in a second

Memory management operations are expensive particularly when a garbage collector is involved

### <mark style="background: #AD21D9;">onDraw():</mark>

Every custom view you create must implement the ``onDraw()`` method

Responsible for redrawing the entire view, whenever android or your code requests it.

All drawing must be described through primitives or bitmaps

Recommended that you use primitives as they are quick to render and will scale up and down easily

### <mark style="background: #AD21D9;">onDraw() - the importance of Algebra:</mark>

This is a situation where Algebra and Linear Algebra is particularly useful.

The reason for this is that the only method we have of describing drawing operations to a computer is through the use of mathematics

You will have to come up with all sorts of formulas to position, size, and angle your components, especially if you have primitives or sets of primitives that are required to move around the view.

If you manage to describe a view accurately through algebra you will gain the following benefits
- You will get a view that will display properly on any screen, regardless of pixel density of the device or the physical screen size
- If you previously used bitmaps to implement the view then you can remove them and save space
- The component can be reused elsewhere with little to no modification required

### <mark style="background: #AD21D9;">onDraw() - primitives:</mark>

As you will be doing all the drawing you have access to a set of primitives

Things like lines, arcs, circlues, rectangles, ovals, and text

These are easy to describe mathematically. More complex shapes can be described by composing out of these simpler shapes

Along with the use of transformation operations and a matrix stack

### <mark style="background: #AD21D9;">Matrix Stack:</mark>

Part of the reason for this is that hardware acceleration is provided by OpenGL ES thus makes sense to use the same OpenGL ES model

The main used for the matrix stack is to eliminate rendering glitches that are caused by rounding errors in floating point numbers

As floating point numbers are an approximation and not a precise value

This is a stack for storing 4x4 matrices which determine the position and orientation of the drawing origin in the current view

If you were to change the position and move back by using offsets you would eventually introduce rounding errors as the position is represented by floating point numbers

By maintaining a history of the drawing origin and using copy and paste we can prevent these errors from occurring

Initially when the view is first constructed and initialised the origin of drawing is at the top left corner of the view.

### <mark style="background: #AD21D9;">Matrix Stack: Save and Restore:</mark>

The canvas provides two methods to manipulate this stack, they are ``save()`` and ``restore()``
- With save() we take a copy of the current transformation matrix and store it on the stack
- With restore() we remove the matrix on top of the stack and set that as our current transformation matrix

Take great care however to make sure that for every ``save()`` you have a corresponding ``restore()`` and vice versa

Otherwise you will get graphical glitches and possibly exceptions

### <mark style="background: #AD21D9;">Matrix Stack: Translate, Scale, and Rotate</mark>

Translate, Scale, and Rotate are the three standard methods through which the transformation matrix can be modified.

It does this by multiplying in a matrix representing the operation to the current matrix, thus the current matrix collects all modifications
- ``translate()`` move the origin of drawing by an offset. As we are doing 2D we have an offset in X and Y
- ``scale()`` allows you to draw an object larger or smaller without having to change the coordinates of your object
- ``rotate()`` allows you to rotate the drawing origin by any angle without having to change its coordinates

### <mark style="background: #AD21D9;">Invalidation:</mark>

For this we use the ``invalidate()`` method, this asks the OS to schedule a redraw of the view

Never under any circumstances call the ``onDraw()`` method directly.

If you call ``onDraw()`` you may potentially cause an infinite loop and lock up your application.

There will be times where you will internally modify the state of your view and it will need to be redrawn.

### <mark style="background: #AD21D9;">onMeasure():</mark>

Sometimes you will want to restrict the size and shape of your view. ``onMeasure()`` can be used to do this.

For example with game boards you may want ot have a square shaped view.

``onMeasure()`` will be called when android changes the size of your view. It does this to give your view a chance to reduce its pixel size should you not need the amount of pixels it is offered

Any changes made here will be reflected in your final view size

Note that it is not possible to gain extra pixels in this method

For example if you wish to make a square view in android using this method:
- You will get a width and height provided to you
- Pick whatever is the smallest dimension
- Set your width and height to be that size

### <mark style="background: #AD21D9;">onTouchEvent():</mark>

Most custom views will require some form of interaction with the user. In this environment the main method of interaction is through touch
- Your interaction with all touch is handled through the ``onTouchEvent()`` method
- Either through the use of single touch (simple)
- Or combining multiple touches together (complex)

### <mark style="background: #AD21D9;">onTouchEvent() - Single Touch:</mark>

Single touch is the easiest case as interaction here is similar to that of a pointer in a GUI such as Java Swing or Java FX. There are three main actions
- ``ACTION DOWN:`` when the touch has started
- ``ACTION MOVE:`` when the touch is being dragged along the screen in any direction
- ``ACTION UP:`` when the touch has been finished

### <mark style="background: #AD21D9;">onTouchEvent() - Multi Touch:</mark>

Multi-touch is more complex however, because the android method of touch was originally designed only to accept single touches

However, it was modified to include multi-touch while still retaining support for applications using single touch, thus we have two new actions
- ``ACTION POINTER DOWN:`` for when an additional touch is added
- ``ACTION POINTER UP:`` for when an additional touch is removed

note that ``ACTION MOVE`` is still used to indicate movement

### <mark style="background: #AD21D9;">Integration - layouts:</mark>

It is possible to include your custom views in layouts by adding them into XML layout files

Because your view is not one provided by the SDK you must provide the fully qualified class name of the java file containing the view

`< package > . < class >`

### <mark style="background: #AD21D9;">Integration - Attributes:</mark>

The ``AttributeSet`` class is useful here as it divides attributes into namespaces

So, for example the attribute ``foo:bar`` would have a namespace of foo with an attribute name of bar. Attributes without namespaces have a null namespace

It is also possible to make your view understand attributes to make them more flexible.

### <mark style="background: #AD21D9;">Integration - Event Handlers:</mark>

Finally, if you are considering releasing your custom view for others to use you may wish to implement event handlers and event listeners
- Prevents the need for other developers to access your source code
- Gives them the minimum required effort to integrate your view into their own application
- Won’t cover here but easy enough to implement

# <mark style="background: #AD21D9;">08 Threads and Concurrency:</mark>

### <mark style="background: #AD21D9;">MultiTasking:</mark>

<mark style="background: #AD21D9;">Nowadays, we multitask all the time:</mark>
1. Read and scroll text of Web page while graphics load.
2. Print document in background while opening another for editing.
3. Reply to email while new message with large file is quietly downloaded.

Threads make all this convenience possible.

### <mark style="background: #AD21D9;">Recap:</mark>

When <mark style="background: #AD21D9;">OS</mark> starts running a program, it creates a new <mark style="background: #AD21D9;">process</mark>.
- A process is a program that is currently executing.
- Every process has at <mark style="background: #AD21D9;">least one</mark> thread running within it.
- When JVM is started, a new process is created

<mark style="background: #AD21D9;">You might think of Java code execution as:</mark>
1. starting with main() method
2. following a path until all statements are completed.

This is an example of a single thread.

2nd thread is always running in JVM i.e. garbage collection thread.

<mark style="background: #AD21D9;">If program includes GUI, JVM starts more threads:</mark>
1. One in charge of delivering GUI events to methods in program
2. Another responsible for painting GUI window.

### <mark style="background: #AD21D9;">In Java:</mark>

Steps to create and run new thread in Java are:
1. Extend ``Java.lang.Thread`` class. Implement run method in this subclass.
2. Create an object of this subclass.
3. Call start method on this object

### <mark style="background: #AD21D9;">In Kotlin:</mark>

```Kotlin
class MyThread : Thread() {
	override fun run() {
		for (i in 0 until 100) {
			println("Thread!")
		}
	}
}
```

```Kotlin
fun main() {
	val t = MyThread()
	t.start()
	
	for (i in 0 until 100) {
		println("Main!")
	}
}
```

### <mark style="background: #AD21D9;">Multithreading:</mark>

![](https://i.imgur.com/dn5v5Dv.png)

### <mark style="background: #AD21D9;">In General:</mark>

3 threads T1, T2, and T3 running on machine with 2 processors.

First, processor 1 runs T1 and the other T2

Then processor 2 switches to run T3.

T2 simply pauses, until its next time slice on a processor.

![](https://i.imgur.com/sMEdPWh.png)

### <mark style="background: #AD21D9;">Lifecycle of a thread:</mark>

![](https://i.imgur.com/FmU75gg.png)

### <mark style="background: #AD21D9;">Modifying the UI with Threads:</mark>

We can do a lot of different operations using the thread class but if we try to modify the UI then we will most likely get an error.

However, Android allows you to use the method ``.runOnUiThread`` to modify the UI directly from a thread

```Kotlin
private fun yourMethodName() {
	Thread {
		try {
			yourActivity.runOnUiThread {
				txtview.text = "some value"
				edittext.setText("some new value")
			}
			} catch (e: Exception) {
				// print the error here
				e.printStackTrace()
		}
	}.start()
}
```

### <mark style="background: #AD21D9;">Back to Android!</mark>

Having a great <mark style="background: #AD21D9;">idea</mark> is a start towards making a cool app.

Next is focus on app's performance e.g. users want apps that:
1. Use power <mark style="background: #AD21D9;">sparingly</mark>.
2. Start up <mark style="background: #AD21D9;">quickly</mark>.
3. <mark style="background: #AD21D9;">Respond</mark> quickly to user interaction.

Today we are interested in responsiveness, hence threads.

### <mark style="background: #AD21D9;">Single Process:</mark>

When an app component (e.g. Activity) starts and <mark style="background: #AD21D9;">no other</mark> components running:

Android starts new <mark style="background: #AD21D9;">Linux</mark> process with <mark style="background: #AD21D9;">single</mark> thread of execution.

By default, all components of app run in the <mark style="background: #AD21D9;">same</mark> process and thread (called “Main" thread).

### <mark style="background: #AD21D9;">Main Thread:</mark>

Independent <mark style="background: #AD21D9;">path of execution</mark> in a running program

Code is executed <mark style="background: #AD21D9;">line by line</mark>.

App runs on Java thread called "main" or "UI thread"
1. <mark style="background: #AD21D9;">Draws</mark> UI on the screen
2. <mark style="background: #AD21D9;">Responds</mark> to user actions by handling UI events

Must be Fast!

Hardware updates screen every 16 milliseconds

UI thread has 16 ms to do all its work

If it takes too long, app stutters or hangs

![](https://i.imgur.com/2Zmy4iV.png)


If the UI waits <mark style="background: #AD21D9;">too long</mark> for an operation to finish, it becomes unresponsive. After 5 seconds of this… The framework shows an <mark style="background: #AD21D9;">Application Not Responding (ANR)</mark> dialog

<mark style="background: #AD21D9;">There are two rules that android uses to determine if an app is unresponsive:</mark>
- Must process a user input event < 5 seconds
- ``BroadcastReceiver`` must finish processing an intent < 10 seconds regardless of source

![](https://i.imgur.com/4SC07RN.png)


### <mark style="background: #AD21D9;">Rules – Consequences of non-observance:</mark>

If you do not respect these rules and adapt your applications in response you can expect the following to happen to your application
- It will be killed by android for being irresponsive
- Your application may lose data as a result
- Eventually users will become frustrated with your application and will uninstall it and replace it by something else

### <mark style="background: #AD21D9;">How Rules affect the App Developer?</mark>

Required to keep your application as responsive as possible

A form of multithreading

Where expensive and long running operations are run on a separate background thread

Leaves the UI thread available for responding to user input events

### <mark style="background: #AD21D9;">Long Running Tasks:</mark>
- Network operations
- Long calculations
- Downloading / uploading files
- Processing images
- Loading data

### <mark style="background: #AD21D9;">Background Threads:</mark>

Execute long running tasks on a <mark style="background: #AD21D9;">background</mark> / worker thread

![](https://i.imgur.com/rbBzP9U.png)

### <mark style="background: #AD21D9;">2 Golden Rules:</mark>

<mark style="background: #AD21D9;">Do not block the UI thread:</mark>
- Complete all work in less than 16 ms for each screen
- Run slow non-UI work on a non-UI thread

Do not access the Android UI toolkit from outside the UI thread. Do UI work only on the UI thread

### <mark style="background: #AD21D9;">Worker Threads:</mark>

As we know, <mark style="background: #AD21D9;">vital</mark> not to block UI thread.

Operations that are <mark style="background: #AD21D9;">not</mark> instantaneous, should be done in threads.

However, we can <mark style="background: #AD21D9;">only</mark> update UI from UI thread.

Android offers <mark style="background: #AD21D9;">several</mark> solutions to this e.g. ``View.post(Runnable)``

### <mark style="background: #AD21D9;">Post Runnable:</mark>

```Kotlin
fun onClick(v: View) {
	Thread(Runnable {
		// A potentially time consuming task.
		val bitmap = processBitMap("image.png")
		
		imageView.post {
			imageView.setImageBitmap(bitmap)
		}
	}).start()
}
```

Background operation is done from <mark style="background: #AD21D9;">separate</mark> thread

``ImageView`` is always manipulated from UI thread.

This kind of code can get complicated and difficult to <mark style="background: #AD21D9;">maintain</mark>.

A better solution is the use of <mark style="background: #AD21D9;">Java Threads for Java</mark> and <mark style="background: #AD21D9;">coroutines for Kotlin</mark>, which simplifies the whole process.

### <mark style="background: #AD21D9;">Services:</mark>

<mark style="background: #AD21D9;">There are four different types of app components:</mark>
- Activities (already covered)
- Services
- Broadcast receivers
- Content providers (not related to multithreading)

Each type serves a distinct purpose and has a distinct lifecycle that defines how the component is created and destroyed.

An application component that can perform long-running operations in the background and does not provide a user interface

In other words: A Service is an Android component that is, almost exactly, an Activity with no UI. Why services? And do we actually need them now?

Started manually via API, or via IPC

### <mark style="background: #AD21D9;">Do You Really Need a Service?</mark>

Services run continuously, draining battery, so use sparingly!

If you only need to perform something in the background while user interacts with your app, just use threads!

### <mark style="background: #AD21D9;">Service Types:</mark>

<mark style="background: #AD21D9;">Started:</mark> A service is "started" when an application component (such as an activity) starts it by calling ``startService()``

<mark style="background: #AD21D9;">Bound:</mark> A service is "bound" when an application component binds to it by calling ``bindService()``

### <mark style="background: #AD21D9;">Started Service:</mark>

Started by ``startService()``

Runs in background indefinitely until it stops itself with ``selfStop()`` or stopped by ``stopService()``

Separate from activity that started it

Does not return any result to the caller

Identified by implementing ``onStartCommand()``

### <mark style="background: #AD21D9;">Bound Service:</mark>

Bound when called with ``bindService()``

Offers client-server interface allowing interaction, get requests, send results

Identified by implementing ``onBind()``

Runs as long as another application component is bound to it (can be multiple). When all unbind, the service is destroyed

### <mark style="background: #AD21D9;">Services:</mark>

<mark style="background: #AD21D9;">Services can be both started and bound at the same time:</mark>
- Implemented both ``onStartCommand()`` and ``onBind()``
- Requires both ``serviceStop()`` or ``selfStop()`` AND all app component to unbind to be destroyed

By default service runs within the main thread of the application!

### <mark style="background: #AD21D9;">Service Methods:</mark>

- ``onCreate()``
- ``onBind()``
- ``onStartCommand()``
- ``onDestroy()``

![](https://i.imgur.com/ceCooKa.png)

### <mark style="background: #AD21D9;">Services - Uses:</mark>

Used when need to keep something running in background while application is not running
- Polling for notifications for a user
- Facebook app (amongst others) are capable of sending you notifications even though the application is not active

Or used for monitoring something without the need for a foreground application e.g. Battery monitors

### <mark style="background: #AD21D9;">Sending notifications to the user:</mark>

When a service is running, it can notify the user of events using:
- snackbar notifications or
- status bar notifications.

A snackbar notification is a message that appears on the surface of the current window for only a moment before disappearing.

A status bar notification provides an icon in the status bar with a message, which the user can select in order to take an action

### <mark style="background: #AD21D9;">Services -Manifest File:</mark>

Like activities, all services must be declared in the manifest file

If an application tries to start an undeclared services, it is considered a security risk and is immediately killed

To declare a service, you must use the ``<service />`` tag

### <mark style="background: #AD21D9;">Broadcast Receiver:</mark>

A broadcast receiver is a component that enables the system to deliver events to the app outside of a regular user flow, allowing the app to respond to system-wide broadcast announcements.

Listeners could subscribe in order to get notification of events that were of interest.

``BroadcastReceivers`` have proved to be too expensive and too prone to security problems to be used pervasively.

They remain mostly a tool used by the system to signal applications of important events.

### <mark style="background: #AD21D9;">Kotlin Coroutine:</mark>

A coroutine is like a lightweight thread that lets you run multiple pieces of code asynchronously.

Using coroutines means that you can launch a background job without the rest of the code having to wait around for it to complete.

Coroutines can be suspended and resumed mid-execution. This means you can have a long-running task, which you can execute little-by-little. You can pause it any number of times, and resume it when you’re ready again.

### <mark style="background: #AD21D9;">Implementation:</mark>

Mark the targeted method with suspend

``Suspend fun insert()``

Launch the coroutine in background

``yourClass.launch(){x.insert()}``

You can also use asynch instead of launch where:
- <mark style="background: #AD21D9;">launch:</mark> fire and forget
- <mark style="background: #AD21D9;">async:</mark> perform a task and return a result

More is here https://developer.android.com/kotlin/coroutines/coroutines-adv

### <mark style="background: #AD21D9;">WorkManager:</mark>

There are times when you’ll want your app to process data in the background.

This might be because it needs to access storage, for example, or it needs to download a large file.

You can use Kotlin coroutines for tasks that need to be executed immediately.

But what if you want to defer the task, or have a long-running task that must continue to run, even if the device restarts?

### <mark style="background: #AD21D9;">Use WorkManager to schedule deferrable tasks</mark>

If you want to schedule a task to run in the background, you can use Android’s ``WorkManager`` API.

It’s designed for potentially long-running tasks that are guaranteed to run even if the user quits the app or restarts the device.

 You can even use WorkManager to run tasks when certain constraints are met, such as when WiFi is available, or chain complex tasks together.

More on https://developer.android.com/topic/libraries/architecture/workmanager

# <mark style="background: #AD21D9;">09 Sensors:</mark>

### <mark style="background: #AD21D9;">Introduction:</mark>

While smartphones may have less computation power than laptops/PCs and battery limitations, they have one significant advantage: 

They have sensors to measure aspects / properties of the current environment  

<mark style="background: #AD21D9;">In this lecture:</mark>  
- we will introduce the various sensor types, 
- coordinate systems and  
- the issues that surround sensors

![](https://i.imgur.com/DKdLdzB.png)

### <mark style="background: #AD21D9;">Sensors:</mark>  

Sensors permit a device to collect data about the current environment,  

While data is basic it can provide useful information about what a user is doing / state  

Examples in latest generation devices include heart rate monitors and step counters  

For tracking user health and fitness

![](https://i.imgur.com/Np8ts5T.png)

### <mark style="background: #AD21D9;">Scalar Sensors:</mark>  

<mark style="background: #AD21D9;">Sensors are divided into two types:</mark>  
- Scalar
- Vector  

A scalar sensor is a sensor that reads a single valued property about an environment  

That property has no directional component, e.g. ambient temperature

![](https://i.imgur.com/3e1q2zQ.png)

### <mark style="background: #AD21D9;">Light Sensors:</mark>  

The light sensor measures ambient light levels in an environment  

Unit of measurement = Lux  

0 represents complete darkness while increasing values represent increasing brightness.  

Well lit room will approximately be 300 to 500 lux  

One of the main uses of this sensor is automatic adjustment of screen brightness in response to room lighting level.

### <mark style="background: #AD21D9;">Temperature Sensor:</mark>

![](https://i.imgur.com/DmsjhFy.png)

### <mark style="background: #AD21D9;">Proximity Sensor:</mark> 

Proximity sensors measure how close an object is to the sensor  

Unit of measurement is centimetre  

Disable/enable a screen when user moves device to their ear for a phone call.  

Also used when a device is put face down to silence the device from accepting calls.

### <mark style="background: #AD21D9;">Barometric Sensors:</mark>

![](https://i.imgur.com/dg2LKqV.png)

### <mark style="background: #AD21D9;">Vector sensors:</mark> 

Vector sensors are sensors that measure data in more than one dimension  

All vector sensors in android will measure in three directions  

These sensors tend to be the most common in android devices  

As they provide much more information about the environment to the user

![](https://i.imgur.com/mmOuBqq.png)

### <mark style="background: #AD21D9;">Accelerometers:</mark>

An accelerometer is used to measure accelerations in all three directions 

<mark style="background: #AD21D9;">Acceleration</mark> = rate in change in velocity.  

Higher absolute values state that device is undergoing quicker changes in speed  

The SI unit here is metres per second squared ms<sup>−2</sup> but common to convert this is G-force units as well 1g = 9.81ms<sup>−2</sup>  

More commonly used sensors

### <mark style="background: #AD21D9;">Gyroscopes:</mark>  

Gyroscopes are used to measure the speed of rotation of device  

Unit of measurement is radians per second. 

Higher absolute values represent faster device rotation  

Another more commonly found sensor  

Used with an accelerometer to generate device orientation

### <mark style="background: #AD21D9;">Magnetic field sensors:</mark> 

Magnetic field = detect the magnetic field strength of the earth  

Unit of measurement here is the <mark style="background: #AD21D9;">micro-Tesla</mark> (μT).  

Higher values indicate a stronger magnetic field  

Generally used to get device orientation if gyroscope is not available  

More recent use is for magnetic covers to turn screens on and off automatically.

### <mark style="background: #AD21D9;">Virtual Sensors:</mark>  

Using sensors like the accelerometer may not be the best approach  

In the case of the accelerometer, will not always have a gravity component need in application  

Thus, Android provides a series of virtual sensors that will provide filtered versions of data and common combinations of sensors  

Here we look at a few of these virtual sensors.

### <mark style="background: #AD21D9;">Linear Accelerometer:</mark>

The linear accelerometer is a high pass filter applied to the values that come back from the accelerometer  

The high pass filter will remove the gravity component from the accelerometer as it is constant and has a frequency of zero  

This will only leave the accelerations on the device that are caused by the user  

Generally used in place of the raw accelerometer

### <mark style="background: #AD21D9;">Gravity Sensor:</mark> 

The gravity sensor is a low pass filter applied to the accelerometer  

Thus removing all of the user induced accelerations on the device  

Main use = determining orientation  

Generally more interested in removing the gravity component

### <mark style="background: #AD21D9;">Rotation Vector:</mark> 

The rotation vector is a combination of the accelerometer and gyroscope that is used to determine a three axis orientation of a device  

Has a different coordinate system to the other sensors  

Will produce a set of values that will enable the device to determine its compass bearing and the pitch and roll of the device

### <mark style="background: #AD21D9;">Sensors and uses - Summary:</mark>

![](https://i.imgur.com/Tue7RdT.png)

### <mark style="background: #AD21D9;">Location Sensors:</mark>

One of the more important sensors within the device

Used to locate the device on the surface of the planet

Mainly used for navigation and geotagging purposes.

Also used for anti-theft measures

### <mark style="background: #AD21D9;">GPS:</mark> 

This is the most accurate of the location sensors. Uses the Global Positioning System satellite signals  

Can provide accuracy to within a few metres  

Generally used for navigation but because it does not encode direction it is assisted by the rotation vector  

BUT ... does not work indoors

### <mark style="background: #AD21D9;">Network Location:</mark> 

“location system” that uses a database of network access points and their location  

Provides an approximation of the location of the device  

However, unlike GPS it works both indoors and outdoors  

Generally the two will be combined to provide a full location for the device indoor and outdoor.

### <mark style="background: #AD21D9;">Android Sensor Management:</mark> 

Sensors are managed through a series of sensor classes  

To hide the individual differences in how each sensor is managed.  

Provide a unified interface to the developer  

All applications must register interest in sensors directly with the Android OS  

To reduce battery usage, android will deliver updates at the rate required by each individual application rather than have multiple applications polling the sensor.

### <mark style="background: #AD21D9;">Permissions:</mark> 

Getting access to majority of sensors does not require any form of permissions  

Very difficult to do any kind of malicious activity just by reading gyroscopes and accelerometers  

However, for the location sensors , there is explicit permissions required  

As an application can track the user’s location and user may not want to disclose this information  

May cause privacy issues if sensor is being used for gait analysis to determine health.

### <mark style="background: #AD21D9;">Sensor Querying:</mark> 

No guarantee that a sensor will be on a device  

While variety of sensors appear on majority of devices, some rarely default on all (temperature and barometric )  

Expected to query the existence of a sensor before using it  

Generally ask for the default sensor of the type you are interested in.  

If a null value is returned then the device has no sensors of that type.

### <mark style="background: #AD21D9;">Sensor Manager Class:</mark> 

Class through which all access to sensors is handled and where sensor listeners registered  

You will query this service for all of the sensors you require in your application  

Register listeners for those sensors with this service  

It will then take responsibility for triggering your listeners whenever a new sensor value is obtained.

### <mark style="background: #AD21D9;">Sensor Class:</mark> 

Contains all the information about each sensor that a device has  

Includes all the constants that differentiate between the different sensor types  

You can use this to query the specification of the individual sensors  

For example if you are looking to compare the sensors of each individual type and are looking for the best one

### <mark style="background: #AD21D9;">Sensor Listeners:</mark> 

Small segments of code that provide a means of capturing new sensor values  

Values may then be used to update your application and UI  

Also includes information about the current accuracy of the sensor  

Gives you a chance to change another sensor if there is another one available or to change your UI to inform user of lower accuracy

### <mark style="background: #AD21D9;">Sensor Delay Types:</mark> 

There are three main default sensor update rates (possible to define custom rates as well provided they are greater than or equal to the first constant listed)  

<mark style="background: #AD21D9;">SENSOR DELAY FASTEST:</mark> get updates from sensor as fast as it can produce them  

<mark style="background: #AD21D9;">SENSOR DELAY GAME:</mark> get updates from the sensor at a rate that is appropriate for game loop processing  

<mark style="background: #AD21D9;">SENSOR DELAY UI:</mark> get updates from the sensor at a rate that is suitable for updating a UI

### <mark style="background: #AD21D9;">Where Sensors fit in with the Activity Life Cycle:</mark> 

Recommended that sensors should register when application is not in the stopped state  

Generally users are not interested in sensor values if not active  
- Deregister listeners in the ``onStop()`` method and  
- Reregister in the ``onStart()`` method as a way of conserving battery power

### <mark style="background: #AD21D9;">GPS and the activity lifecycle:</mark> 

The same advice applies to location sensors with a few minor exceptions  

The main exception is the navigation case  

This is because if a navigation app is interrupted and removes location listeners, upon reregistering it will take about 5 to 10 seconds to get a GPS fix.  

If you are constrained by this then keep the sensor active, otherwise deregister it.

### <mark style="background: #AD21D9;">Issues to consider with sensors:</mark> 

While sensors do provide a lot of information about the environment and your user there are issues to consider with their use  

These must be considered carefully  

As they will affect the level of trust of your users and also the amount of information you collect on them  

Also the performance of your application and associated battery drain

### <mark style="background: #AD21D9;">User Tracking:</mark> 

One of the most important issues is the use of location sensors to track user location  

Possible for this data to be abused - Track a user’s full movements throughout a long period of time  

If app is going to track user, must inform them initially and give a chance to opt out

### <mark style="background: #AD21D9;">Clarity on data use:</mark> 

Like permissions you should be fully clear on what data you use from sensors and what for  

Applications that do this generally are safe and more likely to be trusted by users  

If you collect such data from your user (particularly location) and store on a server somewhere, please secure it with encryption  

And also if you can anonymise and scrub as much identifying information as is possible

### <mark style="background: #AD21D9;">Battery Use:</mark>  

Delicate balancing act between  
- sensor accuracy  
- performance 
- battery power  

Higher poll rates on sensors produce quicker updates & will improve the accuracy of application  

But ... this will cause higher battery power consumption  

Inversely, save battery at the expense of timeliness & accuracy

### <mark style="background: #AD21D9;">Sensor Accuracy:</mark> 

Another issue to consider is that every sensor will have different accuracies and value ranges  

Devices with cheaper sensors may not provide many values and their accuracy may be questionable  

More expensive sensors will provide higher accuracy and values but will cost more  

You cannot assume any base level with regards to accuracy and value range with any sensor on any device

### <mark style="background: #AD21D9;">When to use multiple sensors of the same type:</mark> 

Some devices will provide more than one of the same sensor type  

It is possible to register interest in more than one sensor of the same type  

Only done if you need higher accuracy than you get from a single sensor  

Through the use of averaging or filtering both sensors

### <mark style="background: #AD21D9;">Sensor values are not absolute:</mark>  

Sensors may not represent values as a continuous range but as discrete steps with a gap in between  

While a sensor measure a continuous variable the sensor has to represent this as a discrete value  

Thus there will be a level of error associated between what the sensor reports and the actual value of that property in the environment  

Usually more expensive sensors will have more discrete levels leading to a larger set of values that can be represented

### <mark style="background: #AD21D9;">Rotation Coordinate System:</mark> 

Rotation vector uses the ground plane as reference instead of the device  

X axis is pointing right - represents <mark style="background: #AD21D9;">pitch</mark> axis of device  

Y axis pointing vertically up - represents <mark style="background: #AD21D9;">roll</mark> axis of device  

Z axis pointing towards user - represents the <mark style="background: #AD21D9;">compass</mark> direction

![](https://i.imgur.com/lsEFvei.png)

### <mark style="background: #AD21D9;">Location Coordinate System:</mark>

Takes advantage of world standard latitude and longitude

Takes the earth and maps the surface as a 2D plane

Latitude determines north/south range [-90,90]

Longitude determines east/west range of [-180,180]

# <mark style="background: #AD21D9;">10 Location Based Services</mark>

### <mark style="background: #AD21D9;">Geographical Co-ordinates:</mark>

To locate object on Earth’s surface, geographical coordinates are needed.  

<mark style="background: #AD21D9;">Most common solution assigns 3 coordinates to each location:</mark> 
- latitude, 
- longitude 
- altitude (km above sea level).  

Earth assumed to be perfect sphere with known radius R.  

Latitude and longitude represents angles (in degrees) of location on surface, with respect to Earth centre.

### <mark style="background: #AD21D9;">Latitude:</mark>

- Equator: 0°  
- North Pole: 90°  
- South Pole: - 90°

![](https://i.imgur.com/uW4lOvH.png)

Loosely speaking, latitude contributes to y (or vertical) component of location.

### <mark style="background: #AD21D9;">Longitude:</mark>

Longitude measures x (or <mark style="background: #AD21D9;">horizontal</mark>) component

Longitude measures x (or horizontal) component.  

Imaginary line that connects Poles passing through Greenwich called Prime Meridian.

![](https://i.imgur.com/5svtV71.png)

Prime Meridian 0°  

Increases <mark style="background: #AD21D9;">Eastwards</mark> to Antipodal Prime Meridian  
at 180°  

Decreases <mark style="background: #AD21D9;">Westwards</mark> Antipodal Prime Meridian: at -180°

![](https://i.imgur.com/9nkqjnJ.png)

### <mark style="background: #AD21D9;">Geographical Co-ordinates:</mark>

![](https://i.imgur.com/YX4wlYQ.png)

![](https://i.imgur.com/QLQvuni.png)

![](https://i.imgur.com/1cLgWmg.png)

### <mark style="background: #AD21D9;">Location:</mark>

Finding location in space of object <mark style="background: #AD21D9;">difficult</mark>.  

No traditional sensor able to locate an object.  

What most sensors do is <mark style="background: #AD21D9;">estimate</mark> distance from target object.  

Sonars and radars send out sound waves and calculate distance by detecting <mark style="background: #AD21D9;">how long</mark> it takes for their signal to bounce back.  

Satellites basically do the same, but using radio waves.

### <mark style="background: #AD21D9;">Solution:</mark>

Solution to locate object relies on <mark style="background: #AD21D9;">several</mark> distance measurements, taken by different <mark style="background: #AD21D9;">sensors</mark>.  

<mark style="background: #AD21D9;">Trilateration</mark>, common technique used to calculate position of object given distance measurements.  

<mark style="background: #AD21D9;">Note:</mark> Another technique called <mark style="background: #AD21D9;">Triangulation</mark> works with angles instead of distances.

### <mark style="background: #AD21D9;">How it Works:</mark>

Suppose we want to find location <mark style="background: #AD21D9;">P</mark>  

Our 1st try uses beacon L, at <mark style="background: #AD21D9;">known</mark> position.  

L can estimate its distance to P, d  

Cannot identify <mark style="background: #AD21D9;">exact</mark> position of P.

![](https://i.imgur.com/ZKKhYFW.png)

Each point at distance d from L is <mark style="background: #AD21D9;">potential</mark> candidate for P.  

Guess for P limited to circle of <mark style="background: #AD21D9;">radius</mark> d around P.

![](https://i.imgur.com/HKIZ15f.png)

Situation <mark style="background: #AD21D9;">improved</mark> by using 2 beacons, L1 & L2.  

We <mark style="background: #AD21D9;">know</mark> P lies along circumference of red circle.  

Similarly, <mark style="background: #AD21D9;">must</mark> be on circumference of green circle

![](https://i.imgur.com/v7CbJrH.png)

Means it has to be at <mark style="background: #AD21D9;">intersections</mark> of 2 circles.  

This suddenly restricts our guess to <mark style="background: #AD21D9;">only two</mark> possible locations.

![](https://i.imgur.com/F3c9uL2.png)

To be absolutely precise, need a 3rd station, L3.  

3 circles will meet at only one point i.e. location of P

![](https://i.imgur.com/pByoVzR.png)

### <mark style="background: #AD21D9;">Global Positioning System GPS:</mark>

Constellation of 27 Earth-orbiting satellites 24 operational + 3 extras  

1½ ton solar-powered units circle globe twice daily at 19,300 km.  

Orbits arranged so, at any time, in any place, at least 4 satellites "visible" in sky.  

GPS receiver's job to locate 4 or more of satellites, figure out distance to each, and use information to estimate its location.

<mark style="background: #AD21D9;">Trilateration Principle also applies in 3D:</mark>

![](https://i.imgur.com/GL0c2KH.png)

At given time (e.g. midnight), satellite begins <mark style="background: #AD21D9;">transmitting</mark> long, digital pattern called a pseudo-random code.  

Receiver begins running <mark style="background: #AD21D9;">same</mark> digital pattern also exactly at midnight.  

When satellite's signal reaches receiver, its transmission of the pattern will <mark style="background: #AD21D9;">lag</mark> a bit behind receiver's playing of pattern.  

Length of <mark style="background: #AD21D9;">delay</mark> is equal to signal's travel time.

Receiver multiplies this time by <mark style="background: #AD21D9;">speed of light</mark> to determine how far signal travelled.  

Assuming signal travelled in <mark style="background: #AD21D9;">straight line</mark>, this is distance from receiver to satellite.  

NOTE: A GPS receiver has to have clear <mark style="background: #AD21D9;">line of sight</mark> to satellite to operate, so dense tree cover and buildings can keep it from getting fix on location.

### <mark style="background: #AD21D9;">WiFi Positioning System (WPS):</mark>

WPS is geolocation system that uses characteristics of WiFi hotspots and other wireless access points to discover where device located.  

Used when satellite navigation such as GPS inadequate:  
1. Multipath <mark style="background: #AD21D9;">interference</mark> / signal blockage indoors.  
2. Establishing a satellite fix would take too long.  

Viable due to <mark style="background: #AD21D9;">rapid growth</mark> of wireless access points in urban areas.

Typical data useful to geolocate wireless access point include its SSID and MAC address:
![](https://i.imgur.com/pgvVwjE.png)

Accuracy depends on number of nearby access points whose positions have been entered into <mark style="background: #AD21D9;">database</mark>

<mark style="background: #AD21D9;">Sample WiFi Hotspots London:</mark>
![](https://i.imgur.com/ZC3XGcl.png)

Many techniques exist to determine <mark style="background: #AD21D9;">distance</mark> or <mark style="background: #AD21D9;">angle</mark> of client devices with respect to access points.  
1. Received signal strength indication (RSSI)  
2. Fingerprinting  
3. Angle of arrival (AoA)  
4. Time of flight (ToF)  

Trilateration or Triangulation <mark style="background: #AD21D9;">algorithms</mark> then be used to determine position of target device.

Database links BSSID to Latitude and Longitude location.  

Then used with e.g. trilateration to get device position.

### <mark style="background: #AD21D9;">Overview:</mark>

A unique feature of mobile apps is location <mark style="background: #AD21D9;">awareness</mark>.  

Users take devices with them everywhere, so app can detect and use device location to customise experience for them.  

Location <mark style="background: #AD21D9;">APIs</mark> available in Google <mark style="background: #AD21D9;">Play</mark> Services for adding:  
1. Location Tracking  
2. Geofencing  
3. Activity Recognition

![](https://i.imgur.com/dEf4Oau.png)

### <mark style="background: #AD21D9;">Battery Drain:</mark>

Location gathering and battery drain are directly related as follows:  
1. <mark style="background: #AD21D9;">Accuracy:</mark> Precision of location data. Higher accuracy, higher battery drain.  
2. <mark style="background: #AD21D9;">Frequency:</mark> How often location is computed. Frequent location computations, more battery used.  
3. <mark style="background: #AD21D9;">Delay:</mark> How quickly location data is delivered. Less delay requires more battery.

### <mark style="background: #AD21D9;">Accuracy:</mark>

In <mark style="background: #AD21D9;">Request</mark> to <mark style="background: #AD21D9;">FusedLocation</mark> API for location updates, use ``setPriority()``  

![](https://i.imgur.com/2k0JRu6.png)

Most accurate location. Computed using as many inputs as necessary e.g. GPS, Wi-Fi, cell and other sensors. May cause significant battery drain

![](https://i.imgur.com/rkRnKC5.png)

Accurate location (within 100m) while optimising for power. Very rarely uses GPS. Typically combination of Wi-Fi and Cell information.

![](https://i.imgur.com/4TqesaZ.png)

Largely relies on cell towers and avoids GPS and Wi-Fi inputs, providing coarse (city-level, within 10km) accuracy with minimal battery drain.

![](https://i.imgur.com/Y06I5ZB.png)
Receives locations passively from other apps for which location has already been computed.

Location needs of most apps can be <mark style="background: #AD21D9;">satisfied</mark> using balanced power or low power options.  

High accuracy should be reserved for apps running in <mark style="background: #AD21D9;">foreground</mark> and require <mark style="background: #AD21D9;">real time</mark> location updates (e.g. Mapping app).

### <mark style="background: #AD21D9;">Frequency:</mark>

In <mark style="background: #AD21D9;">Request</mark> to Fused Location API for location updates configure ``setinterval()`` with interval at which location is computed for your app.  

Use <mark style="background: #AD21D9;">largest</mark> possible value for the interval.  

Especially true for <mark style="background: #AD21D9;">background</mark> location gathering, often a source of unwelcome battery drain.  

Intervals of a few seconds should be <mark style="background: #AD21D9;">reserved</mark> for foreground use cases.

### <mark style="background: #AD21D9;">Delay:</mark>

In Request to Fused Location API for location updates use ``setMaxWaitTime()``  

Pass a value several times larger than interval used in ``setInterval()``  

Locations determined at ``setInterval()`` rate, but delivered in batch after interval set in this method.

### <mark style="background: #AD21D9;">Location Updates:</mark>

![](https://i.imgur.com/QwfDIil.png)

1.) Create Request to store details of  
location updates.

![](https://i.imgur.com/0yqQ3yM.png)

2.) Implement callback for action when location updates arrive.

![](https://i.imgur.com/ulJ859p.png)

3.) Get hold of Location Services.

![](https://i.imgur.com/kCMwqna.png)

4.) Ask it for Fused Location Provider Client.

![](https://i.imgur.com/DPCfQ8g.png)

5.) Request Location Updates with Request and Callback as arguments.

![](https://i.imgur.com/2RPrual.png)

6.) Hardware feeds location data into system and Location object created.
![](https://i.imgur.com/FBT8i6n.png)

7.) Gets stored in list with Locations recorded at other times.
![](https://i.imgur.com/x5DdkNn.png)

8.) Based on delay settings callback called by system with Location Result.

![](https://i.imgur.com/wqtQMwC.png)

9.) Perform action e.g. draw marker on a map
![](https://i.imgur.com/Sz25frX.png)

10.) When no longer needed, best practice to remove updates.
![](https://i.imgur.com/n6yBZud.png)

### <mark style="background: #AD21D9;">Best Practices</mark>

<mark style="background: #AD21D9;">Remove Location Updates:</mark>  
- Common source of unnecessary battery drain is failure to remove location updates when no longer needed.  
- Can happen if activity’s ``onStart()`` or ``onResume()`` methods request location updates without call to remove them in ``onStop()`` or ``onPause()``

<mark style="background: #AD21D9;">Set Timeouts:</mark> 
- Set reasonable timeout when location updates should <mark style="background: #AD21D9;">stop</mark>.  
- Timeout ensures updates don't continue <mark style="background: #AD21D9;">indefinitely</mark> e.g. in scenarios where updates requested but not removed (due to a bug).  
- In Request, add timeout using ``setExpirationDuration()``, which takes value for time in milliseconds <mark style="background: #AD21D9;">since</mark> method was last called.

<mark style="background: #AD21D9;">Batch Requests:</mark>  
- For non-foreground use cases, batch multiple requests together.  
- Use ``setInterval()`` to specify interval at which location be computed.  
- Then, ``setMaxWaitTime()`` to set interval at which location is delivered to app.  
- Value passed to ``setMaxWaitTime()`` multiple of that for ``setInterval()``

![](https://i.imgur.com/JRfQQO1.png)

Location computed roughly every 10 mins. and 6 location data points delivered in batch per hour.  

Still get location updates every 10 minutes, battery conserved because device woken up only once an hour.

### <mark style="background: #AD21D9;">Permissions:</mark>

Apps must request location permission in Manifest:
![](https://i.imgur.com/iPq0IYZ.png)

``ACCESS_COARSE_LOCATION`` for location accurate to within city block  

``ACCESS_FINE_LOCATION`` for precise location

<mark style="background: #AD21D9;">From Marshmallow onwards:</mark>  
- Users grant or deny access to their location for each app.  
- Users can change access permission at any time.  
- Your app can prompt user to grant permission to use location.

![](https://i.imgur.com/EUMyRWZ.png)

User can revoke permission at <mark style="background: #AD21D9;">any time</mark>.  

Check for permission <mark style="background: #AD21D9;">each time</mark> your app uses location

### <mark style="background: #AD21D9;">Things to note about the code:</mark>

A careful choice of these values can make a difference to power consumption and to how your application works:  

``minTime``:  Specifies frequency of location checks 
- Wise choice of value for ``minTime`` will help you reduce power consumption.  
- Elapsed time between location updates will never be less than ``minTime``.  

``minDistance``: This parameter can be turned off by setting its value to 0. However, if ``minDistance`` is set to a value greater than 0, location provider will only send updates to your application if location has changed at least by given distance.  

This parameter is driven by functional requirement of the app

### <mark style="background: #AD21D9;">EXAMPLE:</mark>

Location set up to ``minTime`` of 5 minutes, and using a minimum distance of 1 kilometres

Write the “requestupdates” statement code to set this up

Android app location locates a user at point A, at 9am.  

When does ``onLocationChanged`` method trigger :  
- At 9:02am, the user has moved 10 kilometres to point B;  
- At 9:03, the user is returning back to A and is 5 kilometres away.  
- At 9:05am, the user has moved back to point A again;  
- At 9:07am, the user has moved 20 kilometres from point A  
- At 9:10am, the user has moved 40 kilometres from point A

### <mark style="background: #AD21D9;">Beware of the battery:</mark> 

Battery life limited  

Location updates ``very Power hungry``  

Each provider – GPS, Wifi, Cell based location – separately absorbing battery life  

Only check location when your activity needs to. e.g. Hidden activity doesn’t.  

Use lifecycle methods to stop and start location updates - see code sample:  
- ``onPause()`` - stop updates  
- ``onResume()`` – start up updates again

### <mark style="background: #AD21D9;">Permissions:</mark>

Every Android app runs in a limited-access sandbox.  

App needs permissions to user resource or info outside its sandbox -e.g. sending SMS, location tracking, contacts, Access  

All permissions must be published/listed in the manifest file

![](https://i.imgur.com/lIiXRM1.png)

### <mark style="background: #AD21D9;">Permissions – pre API 23:</mark>

<mark style="background: #AD21D9;">All permissions were dealt with at install time:</mark>  
- All permissions were listed in manifest 
- User prompted at install time  
- User couldn’t revoke  
- Developers started to abuse by asking for too many!

### <mark style="background: #AD21D9;">Permissions – 2 types (API 23 onwards):</mark>

<mark style="background: #AD21D9;">Normal permissions:</mark>  
- Permission needed to get outside user sandbox
- Low risk to user privacy e.g. connecting to the internet, Bluetooth, wifi, and NFC information, setting alarms & wallpapers, modifying audio settings on a device etc.  
- Automatically granted at install time – no user prompt  

<mark style="background: #AD21D9;">Runtime (also called Dangerous):</mark>  
- Dangerous permissions = permissions which could potentially affect the user’s privacy;  
- The user must explicitly agree to grant those permissions. E.g. camera, contacts, location
- Declare in the manifest file
- User can revoke permissions at any run session (i.e. Change their mind...)  
- Must check permission at run time

### <mark style="background: #AD21D9;">Run time check for Dangerous permission (inc location)</mark>

e.g. for location tracking:
![](https://i.imgur.com/jjpZ1ix.png)

### <mark style="background: #AD21D9;">Handle the permissions request response:</mark>

When the user responds to your app's permission request, the system invokes the ``onRequestPermissionsResult()`` method, passing it the user response.  

Need to override that method to find out whether the permission was granted.

![](https://i.imgur.com/bMWHENO.png)

### <mark style="background: #AD21D9;">Location tracking permission:</mark>

<mark style="background: #AD21D9;">ACCESS_COARSE_LOCATION</mark>  
- E.g. Cell_ID, Wifi – 1K-ish  
- ``<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />``
- (If you don’t, security violation error not well flagged... Difficult to diagnose!)  
- Two AndroidManifest.XML permissions involved:

<mark style="background: #AD21D9;">ACCESS_FINE_LOCATION</mark>  
- More specific e.g. 10m  
- e.g. GPS  
- ``<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />``

### <mark style="background: #AD21D9;">Emulator: Mocking up location</mark>

It’s not a real device  

Need to artificially feed in mocked up GPS coordinates  

This tests the location tracker, location listener etc.

![](https://i.imgur.com/bVcvBsa.png)

### <mark style="background: #AD21D9;">GeoCoding:</mark>

![](https://i.imgur.com/8FGgBiT.png)

Longitude: -122.0840  
Latitude: 37.4220  

Reverse Geocoded to:  “1600, Mountview, California, United States”  

<mark style="background: #AD21D9;">Geocoded:</mark>  
- Longitude: -122.0840  
- Latitude: 37.4220

![](https://i.imgur.com/eoJXdx9.png)

<mark style="background: #AD21D9;">Sample Code:</mark>
```Kotlin
// get a geocoder object  
Geocoder geo = new Geocoder(MainActivity.this.getApplicationContext(),  
Locale.getDefault());  
// call the method to translate GPS to address(es)..  
List<Address> addresses = geo.getFromLocation(location.getLatitude(),  
location.getLongitude(), 1);  
if (addresses.size() > 0)  
{  
String addressName = addresses.get(0).getFeatureName() + ", " +  
addresses.get(0).getLocality() + ", " +  
addresses.get(0).getAdminArea() + ", " +  
addresses.get(0).getCountryName();  
}
```

### <mark style="background: #AD21D9;">GeoCode class:</mark>

To use geocoding, get a GeoCode object of the Geocode class

``Geocoder(Context context, Locale locale)`` : Constructs a Geocoder whose responses will be localised for the given Locale

Then, pass in the latitude, longitude to the ``getFromLocation`` method of this class

``getFromLocation(double latitude, double longitude, int maxResults)``: Returns an array of Addresses that are known to describe the area immediately surrounding the given latitude and longitude

### <mark style="background: #AD21D9;">Summary</mark>

Location aware app examples  

<mark style="background: #AD21D9;">Implementing location awareness:</mark>  
- Location providers – GPS, Wifi, Cell  
- LocationManager 
- Criteria/ Best provider..  

minTime/ maxtime  

Battery life – use onPause() and onResume()  

Emulator - mocking up location  

GeoCoding

# <mark style="background: #AD21D9;">11 Fragments:</mark>

Most apps require more than one screen

So far, we’ve just looked at how to create single-screen apps. This is fine for simple applications

What about more complex apps?

### <mark style="background: #AD21D9;">Fragments:</mark>

Introduced in Android 3.0

Gives the developer more control

Allows for greater flexibility in dealing with different screen sizes

Designed to create UI reusability

![](https://i.imgur.com/KktqWYG.png)

Designed to create a more dynamic / flexible design environment for large android devices such as Tablets.

With the development of larger/high density screens for android phones such, they have begun to be used for many apps, that want to support smaller and larger screens with content that can adapt automatically to screen size, beyond the standard android resource model.

<mark style="background: #AD21D9;">A fragment is:</mark>
- like a kind of subactivity that’s displayed inside an activity’s layout.
- It has Java/Kotlin code that controls its behavior, and an associated layout that defines its appearance.
- Fragments can't live on their own. They must be hosted by an activity or another fragment.

<mark style="background: #AD21D9;">While your activity is in the STARTED lifecycle state or higher:</mark>
- fragments can be added, replaced, or removed.
- And you can keep a record of these changes in a back stack that is managed by the activity, so that the changes can be reversed.

### <mark style="background: #AD21D9;">Creating a fragment:</mark>

Similar to creating an Activity, you create a subclass of Fragment

Its call back methods mirror Activity but you should implement the following methods
- ``onCreate()``: Initialise the components of the fragment page
- ``onCreateView()``: This is where you create the UI and return it as a view object
- ``onPause()``: Commit any changes. Pause/ release any resources that you are using

```Kotlin
class ExampleFragment : Fragment(R.layout.example_fragment)
```

### <mark style="background: #AD21D9;">Fragment lifecycle:</mark>

Can be downward and upward as well.

``OnCreateView()`` is the method in which we can inflate our view

We can only reference the view components ``onViewCreated()``

![](https://i.imgur.com/1NhQ2a2.png)

### <mark style="background: #AD21D9;">Fragment within an Activity Layout:</mark>

To display a fragment, you need to add it to an activity’s layout.

You add a fragment to a layout using a ``<fragment>`` tag.

You specify which fragment you want to display by setting the ``android:name`` attribute to the fully qualified fragment name, including its package.

Think of the ``<fragment>`` as a placeholder for where the fragment’s layout should be inserted

### <mark style="background: #AD21D9;">Example of a Fragment setup in a layout xml file:</mark>

```Kotlin
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
	android:orientation="horizontal"
	android:layout_width="match_parent"
	android:layout_height="match_parent"
>
	
	<fragment android:name="com.example.news.ArticleListFragment"
		android:id="@+id/list"
		android:layout_weight="1"
		android:layout_width="0dp"
		android:layout_height="match_parent" 
	/>
	
	<fragment android:name="com.example.news.ArticleReaderFragment"
	android:id="@+id/viewer"
	android:layout_weight="2"
	android:layout_width="0dp"
	android:layout_height="match_parent" 
	/>
</LinearLayout>
```

### <mark style="background: #AD21D9;">Fragment within an Activity Layout:</mark>

The use of ``<fragment>`` tag is suitable only for static fragments

What if the activity has multiple fragments to switch between them?

Then, a container should be used, usually a ``<frameLayout>`` tag is used to reserve a place for multiple fragments.

```XML
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
	android:orientation="horizontal"
	android:layout_width="match_parent"
	android:layout_height="match_parent"
>
	<frameLayout
		android:id="@+id/fargmentFrame"
		android:layout_weight="1"
		android:layout_width="0dp"
		android:layout_height="match_parent" 
	/>
</LinearLayout>
```

### <mark style="background: #AD21D9;">Managing Fragments:</mark>

``FragmentManager`` is the class responsible for performing actions on your app's fragments, such as adding, removing, or replacing them and adding them to the back stack.

Calling it by using ``getFragmentManager()``

You can then find your fragment by tag or ID
- ``findFragmentById()``
- ``findFragmentByTag()``

You can pop fragments directly off the back stack or register a listener to monitor such changes.
- ``popBackStack()``
- ``addOnBackStackChangedListener()``

### <mark style="background: #AD21D9;">Fragment Transactions:</mark>

Fragments are great to setup applications where you may want multiple windows , but if you are on a smaller screen, how do you swap between fragments.

This is achieved by <mark style="background: #AD21D9;">Fragment Transactions</mark>

First an instance of ``FragmentTransaction`` must be gotten from the <mark style="background: #AD21D9;">Fragment Manager</mark>.

```Kotlin
FragmentManager fragmentManager = getFragmentManager();

FragmentTransaction fragmentTransaction = fragmentManager.beginTransaction();
```

Once you have the transaction object, you can call
- ``add(), remove() or replace()``

But you must ``commit()`` before anything will happen , for example

```Kotlin
// Create new fragment and transaction
Fragment newFragment = new ExampleFragment();
FragmentTransaction transaction = getFragmentManager().beginTransaction();
// Replace whatever is in the fragment_container view with this fragment,
// and add the transaction to the back stack
transaction.replace(R.id.fragment_container, newFragment);
transaction.addToBackStack(null);
// Commit the transaction
transaction.commit();
```

### <mark style="background: #AD21D9;">Fragments communicating with its host Activity:</mark>

A fragment can get a reference to the activity that is hosting it by call ``getActivity()`` method , for example :

```Kotlin
View listView = getActivity().findViewById(R.id.list);
```

Alternatively an Activity can gain access to the fragment is running by calling.

```Kotlin
ExampleFragment fragment = 
(ExampleFragment) getFragmentManager().findFragmentById(R.id.example_fragment);
```

### <mark style="background: #AD21D9;">Notes:</mark>

Fragments don’t have a findViewById() method

<mark style="background: #AD21D9;">The Fragment class isn’t a subclass of Activity.</mark>

Even though fragments have a lot in common with activities, the Fragment class doesn’t extend Activity so it doesn’t inherit any of its methods.

Instead, the Fragment class defines its own set of methods.

While many of these look identical to the ones that activities inherit, it doesn’t include methods like ``findViewById()``.

### <mark style="background: #AD21D9;">Summary:</mark>

A fragment has Java/Kotlin code and a layout.

Every fragment extends the Fragment class or one of its subclasses.

Add a fragment statically to an activity’s layout using a ``<fragment>``, or dynamically using a ``<frameLayout>`` placeholder.

``onCreateView()`` gets called each time Android needs the fragment’s layout.

The Fragment class doesn’t extend Activity.

Fragments don’t have a ``findViewById()`` method

# <mark style="background: #AD21D9;">12 Model View Controller</mark>

### <mark style="background: #AD21D9;">Model View Controller S/W Architecture Pattern:</mark>

![](https://i.imgur.com/X4i15pf.png)

### <mark style="background: #AD21D9;">Structuring your code and classes:</mark> 

When you create your various classes in an application, you want to:  
- Promote reusability (e.g. panels for OK/Cancel buttons might be used in several screens)  
- Minimise code maintenance when something changes (e.g. dB structure, new GUI device )  
- Maintain as much flexibility as possible

### <mark style="background: #AD21D9;">Model view controller:</mark>  

<mark style="background: #AD21D9;">MVC</mark> is a common S/W Architecture pattern used for interactive applications (i.e. applications that have a Graphical User Interface)  

<mark style="background: #AD21D9;">Model:</mark> Classes that deal with storing and using data  

<mark style="background: #AD21D9;">View:</mark> Classes or code that deal with the GUI part  

<mark style="background: #AD21D9;">Controller:</mark> (Non graphical) classes that bridge the View and the Model

### <mark style="background: #AD21D9;">MVC:</mark> 

<mark style="background: #AD21D9;">Philosophy:</mark> Keep the parts that may be re-used elsewhere or changed SEPARATE

Similar approach to internet layers:
![](https://i.imgur.com/dz4Z2DZ.png)

We need to keep the layers independent and loose so the changes in the code of one layer do not affect the other modules.

### <mark style="background: #AD21D9;">Model:</mark>  

<mark style="background: #AD21D9;">Model:</mark> classes that deal with storing and using data  

If data structure(s) or rules change... Just change these classes  

Can have multiple different GUIs using the same model?  
- E.g. calculator functions add/subtract, etc  
- Different GUIs (standard web, accessible web, etc)

### <mark style="background: #AD21D9;">View</mark> 

<mark style="background: #AD21D9;">View:</mark> classes that deal with the GUI part  

If the GUI layout changes, don’t (necessarily) need to change the model or control classes  

E.g. change borders of buttons

### <mark style="background: #AD21D9;">Controller:</mark> 

<mark style="background: #AD21D9;">Controller:</mark> (non graphical) classes that bridge the View and the Model  

<mark style="background: #AD21D9;">Kept separate:</mark>  
- Listener classes that trigger behaviour  
- Generally consists of everything that is not the layout or not directly storing/using data

### <mark style="background: #AD21D9;">MVC - Philosophy:</mark>  

<mark style="background: #AD21D9;">Separation of components for:</mark>  
- Reuse – e.g. supposing two different screens in Android have same appearance?  
- Maintainability e.g. supposing I want to change colours of all my screen. Does the kotlin code change?

### <mark style="background: #AD21D9;">Does Android Support MVC S/W architecture pattern?</mark> 

Somewhat.  

Abstracted screen layouts...View  

Easy to maintain if changed without necessarily changing M/C parts  

Static resources are kept separate from dynamic code . . . bit of model  

Dynamic model code.. developer determines E.g. put database code into separate classes from the activity  

Controller code?

### <mark style="background: #AD21D9;">Example:</mark>

![](https://i.imgur.com/aslUbxj.png)

<mark style="background: #AD21D9;">App:</mark> this screen displays a list of tourist destinations

### <mark style="background: #AD21D9;">MVC - List Example:</mark>  

Classes /layouts needed?  

<mark style="background: #AD21D9;">For View bit:</mark>
- Listview Layout to display list etc  
- Row layout  

<mark style="background: #AD21D9;">For Model bit:</mark>  
- What “data” is involved? What can be done to it? Is there a dB involved?  
- Put dB connection/operations into separate class(es) to the activity – then other activities can use this class for dB connection and operations and code is centralised  

<mark style="background: #AD21D9;">For Controller bit:</mark>  
- What’s needed apart from GUI and doing the model part? Activity...

### <mark style="background: #AD21D9;">Other things:</mark> 

<mark style="background: #AD21D9;">Giant all purpose class for everything – wrong!</mark>  
- Hard to maintain  
- Nothing reusable  

<mark style="background: #AD21D9;">Decide which “parts” might be reusable</mark>  
- E.g. database code  
- Parts of screen (OK/Cancel panels) – Android supplies ``<Fragment>``  

<mark style="background: #AD21D9;">Keep MVC as a guiding principle but as with any design:</mark>  
- There is no single “right” answer to how you break your app into classes  
- But design in advance, rather than just letting your code wander along in a single class or two...  

<mark style="background: #AD21D9;">MVC is one S/W architecture and some techniques we’ve seen contradict it</mark>  
- E.g. implementing listeners directly in the activity code  
- Anonymous listeners – embedded against the GUI component – has its own advantages..  
- These approaches have their own merits..  
- Be aware of the trade offs.

# <mark style="background: #AD21D9;">13 Performance:</mark>

### <mark style="background: #AD21D9;">Performance:</mark>  

With more and more apps being developed on Android devices performance is starting to matter to users  

Even through the latest devices have much more horsepower available to them  

In this lecture we will explore some things that can improve the performance of your applications  

To make them run faster, smoother and respond quicker

### <mark style="background: #AD21D9;">Why Performance matters:</mark> 

<mark style="background: #AD21D9;">Performance matters for two main reasons:</mark>  
1. Higher performance means a smoother more Instantaneous application that responds quickly to user input  
2. Apps that exhibit higher performance on the same tasks will complete in a shorter time meaning there is less use of the battery  

Thus it is in your interest to make your applications perform well

### <mark style="background: #AD21D9;">The two basic rules of performance:</mark>  

There are two basic rules to improving performance  
1. Don’t do work that is unnecessary  
2. Avoid memory allocation/deallocation wherever possible  

By observing these rules you will create an application that shows high performance and will place little drain on the battery

### <mark style="background: #AD21D9;">Code Profiler:</mark>  

Most of the performance numbers that you will see here have come from experimentation on Android code  

Code profiler  
- A tool for monitoring execution time of code. A profiler will produce a range of statistics that will show where a program spends the majority of its time.  

Gives an indication as to where the code can be improved to produce extra performance  

<mark style="background: #AD21D9;">Android Profiler:</mark>  
https://developer.android.com/studio/profile/android-profiler.htm

![](https://i.imgur.com/Fycs6Io.png)

![](https://i.imgur.com/blhallc.png)

### <mark style="background: #AD21D9;">Bottlenecks:</mark> 

When performing optimisation, must remember the law of diminishing returns  

Each subsequent optimisation will result in diminishing performance gain  

<mark style="background: #AD21D9;">Goal:</mark> only do optimisation to the point where performance is perceived as being good enough  

This is because you don’t remove bottlenecks in code you simply move them elsewhere

### <mark style="background: #AD21D9;">Memory Allocation/Deallocation - Avoid</mark>  

Memory allocation/deallocation are expensive operations in any OS  

Require a switch from user mode to kernel mode to allocate the memory and another switch back to continue running the application  

Also the more you allocate memory, the more the garbage collector will get involved and will reduce application performance  

There are a couple of examples involving string buffers and parallel single dimension arrays that can help reduce allocation

### <mark style="background: #AD21D9;">The Layout Inspector:</mark>

![](https://i.imgur.com/0Hodh7K.png)

### <mark style="background: #AD21D9;">An Example hierarchy:</mark> 

<mark style="background: #AD21D9;">For the purposes of an example:</mark>  
1. We will use a couple of linear layouts to represent the item that we have shown below  
2. We will use a vertical linear layout for the textviews on the right  
3. And that will be contained in a horizontal linear layout that will have an image on the left

![](https://i.imgur.com/9xKSniQ.png)

### <mark style="background: #AD21D9;">Layout Flattening:</mark> 

A hierarchy like this takes some time to build This will add up significantly if something like this is used in a list view  

Thus flattening this layout to two levels with a relative layout instead of a three level linear layout hierarchy would be beneficial  

An example of a revised layout is shown on the next slide

![](https://i.imgur.com/kCHbvTw.png)

### <mark style="background: #AD21D9;">include and merge:</mark>  

Very simple trick to reduce size of XML code. If you identify component combinations that are frequently reused – split into separate files  

And including them in each layout by using the ``<include/>`` tag  

Each reused layout should have the ``<merge/>`` tags as the root tag  

This way they will be included into the layout without any additional items in its place  

https://developer.android.com/training/improving-layouts/reusing-layouts.html

### <mark style="background: #AD21D9;">Battery Optimisation:</mark>  

In general your applications should try to use as little battery of a device as is possible  

Remember these devices generally last a day at best  

Thus applications that consume battery will be removed quickly  

It is possible however, to modify the behaviour of your application in response to changes in charging state or battery level

### <mark style="background: #AD21D9;">Battery - Determining & Monitoring Charging State</mark>

By registering an intent filter that looks for the ``ACTION BATTERY CHANGED`` intent you can determine information about the charging state  

Will enable you to not only determine if the  
device is charging  

But also if it is charging via USB or from AC  

For example you might ramp up performance when connected to AC than when on Battery or USB.

Using another intent filter it is possible to determine if the battery level is low or if it is ok  

Generally when a battery level goes low, it is good practice to reduce use of resources in application  
  
Enables device to minimize power as possible when the battery level is >=15%

### <mark style="background: #AD21D9;">Battery Levels and Charging States - Responding:</mark>

Good applications will do this when they have been informed that the battery level of the device is low. Some example actions include  
- Reducing the sample rate on sensors to consume less battery power  
- Disabling some functionality entirely e.g. disable access to flash with low power  

If the application is not critical to the system or user then all functionality may be disabled to save power

### <mark style="background: #AD21D9;">Final Optimisations:</mark>

If you must implement an algorithm that is not found in the standard libraries  
- Implement in the most efficient way possible  
- More efficiency == less battery drain  

If know what operations application is expected to mostly do, then use data structures that provide fast implementations of common operations i.e. know your collections!!  

Reduce the amount of work application has to do

# <mark style="background: #AD21D9;">14 Android Security:</mark>

### <mark style="background: #AD21D9;">Android Security:</mark>

Like any operating system of application platform Android has paid significant focus to the security of the system.

An insecure system is unlikely to be adopted by users.

<mark style="background: #AD21D9;">Measures include:</mark>
- Sandboxing 
- Permissions 
- Use of the kernel etc

### <mark style="background: #AD21D9;">Multiple Layer:</mark>

![](https://i.imgur.com/Po5a9sQ.png)

### <mark style="background: #AD21D9;">Android is a Linux based system:</mark>  

The first major decision was to base Android on the Linux kernel  

In existence and use since 1991  

<mark style="background: #AD21D9;">Open Source:</mark> anyone can observe the code and suggest patches  

As a result Android adopts a lot of Linux style security measures by default

### <mark style="background: #AD21D9;">Android is a Linux based system:</mark>  

OS nature of the kernel leads to increased security of the system (?)  

Code & patches are more visible  

Patches analysed & if they show suspicious behaviour or introduce bugs, then are rejected.  

Patches that are accepted should be of sufficient quality to remove bugs or security issues - will go through a checking process by the main development team  

Approved patches will be brought mainline in next release.

### <mark style="background: #AD21D9;">User IDs (UIDs) and group IDs (GIDs)</mark> 

Linux imposes an ID on every user and group  

Users considered individuals while groups are a collection of related users, Any user outside a group is “other”  

File access permissions (read, write, and execute) are managed by a set of permissions on each file  

Permission list like ``rwxr-xr–`` would state that the user has read, write, and execute permissions the group only has read, and execute, while others can only read

### <mark style="background: #AD21D9;">Sandboxing:</mark> 

All applications sandboxed in Android  

Container that stores application’s code and data. Android - single directory  

Applications are permitted to make any modifications to their own sandbox

Android sets the UID and GID for everything in that directory to be the UID & GID of application. Will also set permissions to ``rwx——``  . Each application is isolated from each other and OS.

An application cannot modify or interact with the data of another application

All other files on the system are either owned by another application in a separate directory  

Or files not owned by any application are owned by the root user  

Applications have limited access to touch or modify those files.  

However to complicate matters, the filesystem is divided into two sections

### <mark style="background: #AD21D9;">File system structure:</mark>  

<mark style="background: #AD21D9;">Internal Storage:</mark> private data belonging to an application and holds android OS.  

<mark style="background: #AD21D9;">External Storage:</mark> public shared data that can be accessed by the OS and all applications.  

Please check the latest security changes.

![](https://i.imgur.com/l6CAaHK.png)

### <mark style="background: #AD21D9;">Permissions:</mark>

Forces applications to declare resources that they require in order to function

At install time android must be informed what permissions the app requires to function

This is to stringently control permissions from app to app

Also informs users what the app has access to on the device.

### <mark style="background: #AD21D9;">Permissions: Manifest file:</mark>  

<mark style="background: #AD21D9;">Manifest file</mark> is where all requested permissions must be declared  

Every required permission must be listed here. If the user accepts the required permissions - application will be installed and given those permissions by the OS  

If app tries to access permissions it does not have, OS will immediately kill it as considered a security risk

### <mark style="background: #AD21D9;">Permissions:</mark> 

<mark style="background: #AD21D9;">Whitelisting:</mark> Applications are given no permissions to begin and are only allocated the minimum set of permissions needed  

<mark style="background: #AD21D9;">Blacklisting:</mark> Gives all permissions by default and only removes permissions as needed  

Whitelisting is used to encourage developers to use the minimum set of required permissions  
- Apps with a long list of permissions will be viewed sceptically by users  
- Particularly when sensitive data is involved  

These permissions will be shown to the user before install such that they can read through and spot anything suspicious

### <mark style="background: #AD21D9;">Permissions - Default:</mark>  

Every application will get a default set of basic permissions  

<mark style="background: #AD21D9;">This includes:</mark>  
- Update the screen  
- Interact with user input 
- Generate sound and vibrations  
- Read/Write to sandbox in internal storage

### <mark style="background: #AD21D9;">Permissions - Advice:</mark> 

Always use the absolute min. amount of permissions  

If you don’t need a permission, then get rid of it. 

If you do require a permission, give the user clear and concise information about <mark style="background: #AD21D9;">why</mark> you need it  
- Especially if user data is involved (data - protection law)  
- GDPR

### <mark style="background: #AD21D9;">Permissions - The Human:</mark>

Weakest link in the security chain - Human  

Measures will be useless if the human does not take care when installing apps  

Users are becoming more aware and recognize potential threats to their devices  

There are a number of tricks that unscrupulous developers and apps will try to use to gain access to permissions

### <mark style="background: #AD21D9;">Permissions - Social Engineering:</mark> 

Trick user to either give access to all permissions or ask for more over time  

User effectively invites malware in!  

If you can circumvent the user you also circumvent the entire security system  

There is no patch for human stupidity

### <mark style="background: #AD21D9;">Security Measures - Application level:</mark> 

Mechanisms developer should use to try to make apps secure  

Learning about secure programming (input validation, buffer overflows, etc)  

Will vastly reduce the number of potential security issues in code.

### <mark style="background: #AD21D9;">Security Measures - Network:</mark>

If your application uses any form of networking you should consider using secure forms of transport  

Particularly login/logout & transmission of sensitive data  

HTTPS and SSL sockets are available in API, Provides a level of encryption & protection against attacks  

<mark style="background: #AD21D9;">Network Security Configuration:</mark>
![](https://i.imgur.com/P8Frl89.png)

### <mark style="background: #AD21D9;">Security Measures - Credentials:</mark>  

With regards to credentials try to ask as little as possible  

Avoid storing username/password combinations  

Use authorisation tokens where possible  

The less a user provides username/password combinations the less likely it will be transmitted over the network  

Less likely that it will be captured as well.

### <mark style="background: #AD21D9;">Security Measures - Cryptography:</mark>  

When storing user sensitive information, encrypt it 
- API provides a number of ciphers use them where possible  
- A secure random number generator is also provided.  

Most random number generators are pseudorandom and predictable  

Don’t implement your own encryption mechanism -likely be weaker than whatever is already there.  

<mark style="background: #AD21D9;">Android Encryption – Various levels:</mark>  
- Full Disk  
- File  
- Metadata

### <mark style="background: #AD21D9;">Security Measures: Input Validation:</mark>  

Common mechanism used - Inject code / cause errors with forms that are not properly validated  

Particularly if SQL or JavaScript  

Any input that received should be stringently validated to ensure it adheres to the format expected  

If it looks suspicious, then reject immediately.

![](https://i.imgur.com/bBnM33m.png)